<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.544">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Pedro J. Aphalo">
<meta name="dcterms.date" content="2023-02-28">
<meta name="keywords" content="data labels, ggplot2 pkg, ggpp pkg, ggrepel pkg">
<title>Using R for Photobiology - Nudging + repulsion with ‘ggrepel’ and ‘ggpp’</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../r4p-favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../r4p-logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Using R for Photobiology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../posts.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages.html"> <i class="bi bi-file-richtext" role="img">
</i> 
<span class="menu-text">Pages</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../galleries.html"> <i class="bi bi-images" role="img">
</i> 
<span class="menu-text">R gallery</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-packages" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-box-seam" role="img">
</i> 
 <span class="menu-text">R packages</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-r-packages">
<li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/"><i class="bi bi-list" role="img">
</i> 
 <span class="dropdown-text">Documentation Index</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://r.r4photobiology.info/"><i class="bi bi-cloud-download" role="img">
</i> 
 <span class="dropdown-text">CRAN-like repository</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/learnrbook/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">learnrbook</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/ggpmisc-intro.html"><i class="bi bi-stack" role="img">
</i> 
 <span class="dropdown-text">Intro <em>‘ggpmisc’, ‘ggpp’ and ‘gginnards’</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggpmisc/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggpmisc</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggpp/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggpp</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/gginnards/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">gginnards</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/r4p-introduction.html"><i class="bi bi-sun" role="img">
</i> 
 <span class="dropdown-text">Intro <em>R for Photobiology Suite</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiology/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggspectra/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggspectra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyWavebands/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyWavebands</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyInOut/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyInOut</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ooacquire/"><i class="bi bi-rulers" role="img">
</i> 
 <span class="dropdown-text">ooacquire</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/rOmniDriver/"><i class="bi bi-rulers" role="img">
</i> 
 <span class="dropdown-text">rOmniDriver</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyPlants/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyPlants</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyLamps/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyLamps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyLEDs/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyLEDs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologySun/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologySun</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyFilters/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyFilters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologySensors/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologySensors</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/packages-status.html"><i class="bi bi-check-all" role="img">
</i> 
 <span class="dropdown-text">Checks and issues</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Books</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-books">
<li>
    <a class="dropdown-item" href="https://www.learnr-book.info/"><i class="bi bi-book" role="img">
</i> 
 <span class="dropdown-text">Book <em>Learn R - As a Language</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/beyond-the-visible.html"><i class="bi bi-book" role="img">
</i> 
 <span class="dropdown-text">Handbook <em>Beyond the Visible</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/r4p-book.html"><i class="bi bi-book-half" role="img">
</i> 
 <span class="dropdown-text">Book <em>R for Photobiology</em></span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person" role="img">
</i> 
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">
<li>
    <a class="dropdown-item" href="../about/help.html"><i class="bi bi-question-square" role="img">
</i> 
 <span class="dropdown-text">Site Help</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../about/about.html"><i class="bi bi-pc-display" role="img">
</i> 
 <span class="dropdown-text">About <em>this site</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../about/pedro.html"><i class="bi bi-person" role="img">
</i> 
 <span class="dropdown-text">About <em>Pedro J. Aphalo</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/aphalo/r4p-blog/"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Source of <em>this site</em> at GitHub</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rss-feeds" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text">RSS feeds</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-rss-feeds">
<li>
    <a class="dropdown-item" href="../posts.xml"><i class="bi bi-newspaper" role="img">
</i> 
 <span class="dropdown-text">Blog RSS feed</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages.xml"><i class="bi bi-file-richtext" role="img">
</i> 
 <span class="dropdown-text">Pages RSS feed</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../galleries.xml"><i class="bi bi-images" role="img">
</i> 
 <span class="dropdown-text">Gallery RSS feed</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Nudging + repulsion with ‘ggrepel’ and ‘ggpp’</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Directed/ordered data labels’ positions avoiding overlaps</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Plotting examples</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pedro J. Aphalo </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2023-02-28</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">2023-12-12</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>Example R code for plots with labels without overlaps but with controlled position displacements away from specific plots features such as curves and observations’ density centroids.</p>
    </div>
  </div>

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>data labels, ggplot2 pkg, ggpp pkg, ggrepel pkg</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#position-functions-and-nudging" id="toc-position-functions-and-nudging" class="nav-link" data-scroll-target="#position-functions-and-nudging">Position functions and nudging</a></li>
  <li><a href="#connecting-segments-and-arrows" id="toc-connecting-segments-and-arrows" class="nav-link" data-scroll-target="#connecting-segments-and-arrows">Connecting segments and arrows</a></li>
  <li><a href="#pca-loadings" id="toc-pca-loadings" class="nav-link" data-scroll-target="#pca-loadings">PCA loadings</a></li>
  <li><a href="#aligned-data-labels" id="toc-aligned-data-labels" class="nav-link" data-scroll-target="#aligned-data-labels">Aligned data labels</a></li>
  <li><a href="#clouds-of-observations" id="toc-clouds-of-observations" class="nav-link" data-scroll-target="#clouds-of-observations">Clouds of observations</a></li>
  <li><a href="#lines-curves-and-observations-along-them" id="toc-lines-curves-and-observations-along-them" class="nav-link" data-scroll-target="#lines-curves-and-observations-along-them">Lines, curves and observations along them</a></li>
  <li><a href="#combined-dodge-and-nudge" id="toc-combined-dodge-and-nudge" class="nav-link" data-scroll-target="#combined-dodge-and-nudge">Combined dodge and nudge</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The very popular R package ‘ggrepel’ does a great job at avoiding overlaps among data labels and between them and observations plotted as points. A difficulty that stems from the use of an algorithm based on random displacements is that the final location of the data labels can become more disordered than desirable. In addition when including smooth regression lines the data labels may partly occlude the fitted line and/or the confidence band.</p>
<p>Package ‘ggpp’ defines new position functions that save the starting position like <code><a href="https://ggrepel.slowkow.com/reference/position_nudge_repel.html">position_nudge_repel()</a></code> does but come in multiple flavors. Their use together with repulsive geometries from ‘ggrepel’ makes it possible to give to the data labels an initial “push” in a non-random direction. This helps a lot, much more than what I expect initially, in obtaining a more orderly displacement by repulsion of the data labels away from a cloud of observations or a line.</p>
<p>Because of the naming convention used, the new position functions remain fully compatible with all geometries that have a formal parameter <code>position</code>. However, most examples below use geometries from packages ‘ggrepel’ or ‘ggpp’ to create a plot layer containing data labels as currently geoms from these packages can draw connecting segments or arrows between the original and displaced positions.</p>
</section><section id="preliminaries" class="level2"><h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<p>As we will use text and labels on the plotting area we change the default theme to an uncluttered one.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.r4photobiology.info/ggpp/">ggpp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="co"># Is a compatible version of 'ggrepel' installed?</span></span>
<span><span class="va">eval_ggrepel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"ggrepel"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"ggrepel"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"0.9.2"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">eval_ggrepel</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">old_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="position-functions-and-nudging" class="level2"><h2 class="anchored" data-anchor-id="position-functions-and-nudging">Position functions and nudging</h2>
<p>Nudging shifts deterministically the <em>x</em> and/or <em>y</em> coordinates of an observation. This takes place early enough for the limits of the corresponding scales be set based on the displaced positions. In ‘ggplot2’, position functions and consequently also geometries by default apply no nudging.</p>
<p>Function <code><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge()</a></code> from package ‘ggplot2’ applies the nudge, to <em>x</em> and/or <em>y</em> data coordinates based directly on the values passed to its parameters <code>x</code> and <code>y</code>. Passing arguments to the <code>nudge_x</code> and/or <code>nudge_y</code> parameters of a geometry has the same effect, as these values are passed to <code><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge()</a></code> within the geometry’s code. Geometries also have a <code>position</code> parameter to which we can pass an expression based on a <em>position function</em> which opens the door to more elaborate approaches to nudging, as well as allowing other changes in coordinates such as stacking.</p>
<p>We use <code><a href="https://docs.r4photobiology.info/ggpp/reference/geom_point_s.html">geom_point_s()</a></code> to exemplify what nudging does. The black dots are the original positions and the red ones the nudged positions, with the arrows of length 0.5 along <em>x</em>, showing the displacement and its direction.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/geom_point_s.html">geom_point_s</a></span><span class="op">(</span>nudge_x <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-3-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Function <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_keep.html">position_nudge_keep()</a></code> keeps a copy of the original position making it possible for geometries like <code><a href="https://docs.r4photobiology.info/ggpp/reference/geom_point_s.html">geom_point_s()</a></code> to draw connecting segments or arrows.</p>
<p>Package ‘ggpp’ provides several new position functions to facilitate nudging. All of them keep the original positions to allow links to be drawn. Some of them, just simplify some use cases, e.g., <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to()</a></code>, which accepts the desired nudged coordinates directly, instead of as a displacement away from the initial position. This allows to push data labels away from observations into a row or column.</p>
<p>Other new position functions compute the nudge for individual observations based on different criteria. For example by nudging away from a focal point, a line or a curve. The focal point or line can be either supplied directly or fitted to the observations. In <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center()</a></code> and <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line()</a></code> described below, this reference alters only the direction (angle) along which nudge is applied but not the extent of the shift. Advanced nudging works very well, but only for some patterns of observations and may require manual adjustment of positions, repulsion is more generally applicable but like jittering is aleatory. Combining nudging and repulsion we can make repulsion more predictable with little loss of its applicability.</p>
<p>These position functions can be used with any geometry but if segments joining the nudged positions to the original ones are desired, only geometries from packages ‘ggrepel’ or ‘ggpp’ can currently be used. Geometries <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel()</a></code> or <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_label_repel()</a></code> from ‘ggrepel’ should be used when repulsion is desired. Setting <code>max.iter = 0</code> in these functions disables repulsion but allows the drawing of segments or arrows. Alternatively, several geometries from ‘ggpp’ implement the drawing of connecting segments, but none of them implement repulsion. Please see the documentation for the different geometries from packages ‘ggrepel’ and ‘ggpp’ for the details.</p>
<p>As mentioned above, drawing of segments or arrows is made possible by position functions storing in <code>data</code> both the nudged and original <em>x</em> and <em>y</em> coordinates. The joint use of ‘ggrepel’ and ‘ggpp’ was made possible by coordinated development of these packages and agreement on a naming convention for storing the original position. Keeping both nudged and original positions increases the size of the data, and consequently also the size of the ggplot objects. Because of this, the position functions from ‘ggpp’ allow the keeping of the original positions to be disabled when needed.</p>
</section><section id="connecting-segments-and-arrows" class="level2"><h2 class="anchored" data-anchor-id="connecting-segments-and-arrows">Connecting segments and arrows</h2>
<p>Function <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_keep.html">position_nudge_keep()</a></code> is like <code><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">ggplot2::position_nudge()</a></code> but keeps (stores) the original <em>x</em> and <em>y</em> coordinates. It is similar to function <code><a href="https://ggrepel.slowkow.com/reference/position_nudge_repel.html">position_nudge_repel()</a></code> but uses a different naming convention for the coordinates. Both work with <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel()</a></code> or <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_label_repel()</a></code> from package ‘ggrepel’ (&gt;= 0.9.2), but only <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_keep.html">position_nudge_keep()</a></code> can be used interchangeably with <code><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">ggplot2::position_nudge()</a></code> with other geometries such as <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">84532</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"label:"</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_keep.html">position_nudge_keep()</a></code> from ‘ggpp’ used together with <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel()</a></code> or <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_label_repel()</a></code> segments between a nudged and/or repelled label and the original position (here indicated by a point) are drawn. As shown here, passing <code>max.iter = 0</code> disables repulsion.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_keep.html">position_nudge_keep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>                  max.iter <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="pca-loadings" class="level2"><h2 class="anchored" data-anchor-id="pca-loadings">PCA loadings</h2>
<p>A usually more problematic example is the labeling of loadings in PCA and similar biplots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Example data frame where each species' principal components have been computed.</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Species"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  PC1     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">3.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  PC2     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, label <span class="op">=</span> <span class="va">Species</span>, colour <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">PC1</span>, yend <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span>, </span>
<span>               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="st">"inches"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.2</span>, y <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                                    center_x <span class="op">=</span> <span class="fl">0</span>, center_y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                   label.size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                   label.padding <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                   fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span>red <span class="op">=</span> <span class="fl">1</span>, green <span class="op">=</span> <span class="fl">1</span>, blue <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Stadard settings for displaying biplots</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="aligned-data-labels" class="level2"><h2 class="anchored" data-anchor-id="aligned-data-labels">Aligned data labels</h2>
<p>Function <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to()</a></code> nudges to a given position instead of using the same shift for each observation. It can be used to align labels for points that are not themselves aligned.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="st">""</span>, <span class="va">l</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2.3</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  segment.color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                  arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  direction <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By providing two values for nudging with opposite sign, we can add labels alternating between sides. We use here <code><a href="https://docs.r4photobiology.info/ggpp/reference/geom_text_s.html">geom_text_s()</a></code> but other geometries could have been used as well. How the data labels been closer together repulsion would have been needed in addition to nudging.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">size_from_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">b</span>, size <span class="op">=</span> <span class="va">b</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/geom_text_s.html">geom_text_s</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">b</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              box.padding <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It is also useful when labeling curves than end at different positions along the <em>x</em> axis. In this example we avoid overlaps with repulsion along the <em>y</em> axis. The data set used in this example is dynamic, so we use nudging to a position that is dynamicaly computed from the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Israel"</span>, <span class="st">"United States"</span>, <span class="st">"European Union"</span>, <span class="st">"China"</span>, <span class="st">"South Africa"</span>, <span class="st">"Qatar"</span>,</span>
<span>          <span class="st">"Argentina"</span>, <span class="st">"Chile"</span>, <span class="st">"Brazil"</span>, <span class="st">"Ukraine"</span>, <span class="st">"Indonesia"</span>, <span class="st">"Bangladesh"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/vaccinations.csv"</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">keep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">date</span>, <span class="va">total_vaccinations_per_hundred</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">total_vaccinations_per_hundred</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>,</span>
<span>         location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">total_vaccinations_per_hundred</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># max(date) depends on the location!</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, </span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>, </span>
<span>                         <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">owid</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">owid</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, </span>
<span>           y <span class="op">=</span> <span class="va">total_vaccinations_per_hundred</span>,</span>
<span>           color <span class="op">=</span> <span class="va">location</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">owid</span><span class="op">$</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  segment.color <span class="op">=</span> <span class="st">'grey'</span>,</span>
<span>                  point.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                  point.padding <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                  hjust <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                  direction <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cumulative COVID-19 vaccination doses administered per 100 people"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Date (year-month)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the call to <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to()</a></code> we passed a vector of length one as argument for <code>x</code>, but both <code>x</code> and <code>y</code> also accept longer vectors. In other words, this position function makes it possible manual positioning of text and labels.</p>
<p>In the next example we decrease the forces used for repulsion and the padding so that the labels remain close together. In this way, we can label the observations on the rug of a combined point and rug plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html">position_nudge_to</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">-</span><span class="fl">2.7</span><span class="op">)</span>, </span>
<span>            size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            box.padding <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            min.segment.length <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>            force <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>            force_pull <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span>sides <span class="op">=</span> <span class="st">"b"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-10-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="clouds-of-observations" class="level2"><h2 class="anchored" data-anchor-id="clouds-of-observations">Clouds of observations</h2>
<p>In many cases data are distributed as a cloud with decreasing density towards edges. In some other cases, even with evely distributed observations, a certain partly systematic pattern of displacement of data labels is visually more attractive than a fully random one. In both cases, combining nudging and repulsion is usually an effective approach.</p>
<p>In this example we use repulsion with nudging away from zero. In all cases nudging shifts the coordinates giving a new <em>x</em> and/or <em>y</em> position that expands the limits of the corresponding scales to include the nudged coordinate values, but not necessarily the whole of justified text or labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.3</span>, center_x <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We set a different split point as the value computed by a function function, by name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.3</span>, center_x <span class="op">=</span> <span class="va">median</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-12-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We set a different split point as the value computed by an anonymous function. Here we split on the first quartile along <em>x</em> and <em>y</em> = 2.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                                          center_x <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, </span>
<span>                                                     probs <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, </span>
<span>                                                     names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>                                          <span class="op">}</span>,</span>
<span>                                          direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-13-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By requesting nudging along <em>x</em> and <em>y</em> and setting <code>direction = "split"</code> nudging is applied according to the quadrants centred on the centroid of the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                          y <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>                                          direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-14-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>With <code>direction = "radial"</code>, the distance nudged away from the center is the same for all labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                                          y <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>                                          direction <span class="op">=</span> <span class="st">"radial"</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-15-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can also set the justification of the text labels although repulsion usually works best with labels justified at the centre, which is the default in <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                                          y <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                                          center_x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                          center_y <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                          direction <span class="op">=</span> <span class="st">"radial"</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  hjust <span class="op">=</span> <span class="st">"outward"</span>, vjust <span class="op">=</span> <span class="st">"outward"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.7</span>, <span class="op">+</span><span class="fl">2.3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-16-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nudging along one axis, here <em>x</em>, and setting the repulsion <code>direction</code> along the other axis, here <em>y</em>, tends to give a pleasant arrangement of labels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>position <span class="op">=</span> </span>
<span>                    <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                          center_x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                          direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="st">"outward"</span><span class="op">)</span>,</span>
<span>                  direction <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-17-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>When some regions have a high density of observations we may wish to only label those in the lower density regions. To automate this, we can use statistics <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_labels.html">stat_dens2d_labels()</a></code> or <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens1d_labels.html">stat_dens1d_labels()</a></code> that replace the labels with <code>""</code> but retain all rows in data so that repulsion away from all points is achieved. In contrast, <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_filter.html">stat_dens2d_filter()</a></code> or <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens1d_filter.html">stat_dens1d_filter()</a></code> subset <code>data</code> using identical criteria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_labels.html">stat_dens2d_labels</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text_repel"</span>,</span>
<span>                     keep.fraction <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                     position <span class="op">=</span> </span>
<span>                       <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_center</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                             center_x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                             direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     direction <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>                     min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_filter.html">stat_dens2d_filter</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>                     keep.fraction <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                     shape <span class="op">=</span> <span class="st">"circle open"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-18-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We create a set of example data with a denser distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">random_string</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">len</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span>, <span class="va">len</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Make random data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1001</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">100</span>, <span class="op">{</span> <span class="fu">random_string</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">lab</span>, colour <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_labels.html">stat_dens2d_labels</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text_repel"</span>, </span>
<span>                     keep.fraction <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>                     min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-20-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>With <code>geom_label_repel</code> one usually needs to use a smaller value for <code>keep.fracton</code>, or a smaller <code>size</code>, as labels use more space on the plot than the test alone.</p>
<p>Additional arguments can be used to change the angle and position of the text, but may give unexpected output when labels are long as the repulsion algorithm “sees” always a rectangular bounding box that is not rotated. With short labels or angles that are multiples of 90 degrees, there is no such problem. Please, see the documentation for <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">ggrepel::geom_text_repel</a></code> and <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">ggrepel::geom_label_repel</a></code> for the various ways in which both repulsion and formatting of the labels can be adjusted.</p>
<p>Using <code>NA</code> as argument to <code>label.fill</code> makes the observations with labels set to <code>NA</code> <em>incomplete</em>, and such rows in data are skipped when rendering the plot, before the repulsion algorithm is active. This can lead to overlap between text and points corresponding to unlabelled observations. Whether points are occluded depends on the order of layers and transparency, the occlusion can remain easily unnoticed with <code>geom_label</code> and <code>geom_label_repel</code>. We keep <code>geom_point</code> as the topmost layer to ensure that all observations are visible.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">lab</span>, colour <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_labels.html">stat_dens2d_labels</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label_repel"</span>, </span>
<span>                     keep.fraction <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                     label.fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-21-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The 1D versions work similarly but assess the density along only one of <em>x</em> or <em>y</em>. In other respects than <code>orientation</code> and the parameters passed internally to <code><a href="https://rdrr.io/r/stats/density.html">stats::density()</a></code> the examples given earlier for <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_labels.html">stat_dens2d_labels()</a></code> also apply <code><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens1d_labels.html">stat_dens1d_labels()</a></code>.</p>
<p>An example for a plot based on an enhancement suggested in an issue raised at GitHub by Michael Schubert, made possible by parameter <code>keep.these</code> added for this and similar use cases.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.r4photobiology.info/ggpp/">ggpp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span><span class="va">syms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">labs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">paste0</span>, <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">syms</span>, <span class="va">syms</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1e3</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1e3</span><span class="op">)</span>, label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">labs</span>, <span class="fl">1e3</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey85"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/stat_dens2d_filter.html">stat_dens2d_filter</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text_repel"</span>,</span>
<span>                     position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_center.html">position_nudge_centre</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>                                                      y <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>                                                      direction <span class="op">=</span> <span class="st">"radial"</span><span class="op">)</span>,</span>
<span>                     keep.number <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                     keep.these <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aA"</span>, <span class="st">"bB"</span>, <span class="st">"cC"</span><span class="op">)</span>,</span>
<span>                     min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-23-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="lines-curves-and-observations-along-them" class="level2"><h2 class="anchored" data-anchor-id="lines-curves-and-observations-along-them">Lines, curves and observations along them</h2>
<p>Function <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line()</a></code> nudges away from a line, which can be a user supplied straight line as well as a smooth spline or a polynomial fitted to the observations themselves. The nudging is away and perpendicular to the local slope of the straight or curved line. It relies on the same assumptions as linear regression, assuming that <em>x</em> values are not subject to error. This in most cases prevents labels from overlapping a curve fitted to the data, even if not exactly based on the same model fit. When observations are sparse, this may be enough to obtain a nice arrangement of data labels, otherwise, it can be used in combination with repulsive geometries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">16532</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  y <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>  yy <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  yyy <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  l <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use a repulsive geometry when the label texts are long or the labels are crowded near the line. Combining repulsion and computed nudging is effective.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">yy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">yy</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="va">l</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                   position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>                                                  y <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                                  direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span>,</span>
<span>                   box.padding <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                   min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">12</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-25-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout-hint">
<p>When fitting a polynomial, <code>"lm"</code> should be the argument passed to <code>method</code> and a model formula preferably based on <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code>, setting <code>raw = TRUE</code>, as argument to <code>formula</code>.</p>
<p><em>Currently no other methods are implemented in</em> <code><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line()</a></code>.</p>
</div>
<p>In the case of data labels that are small, a single character in the next example, we also benefit from nudging if they are near a fitted line. Nudging plus repulsion, shown next, will be compared to alternatives. In this case we assume no linking segments are desired as there is enough space for the data labels to remain near the observations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">yy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">yy</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span>,</span>
<span>                  position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>                                                 formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                                 x <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                                                 y <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                 direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span>,</span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-26-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Using nudging alone there is little difference, but there is always the posibility of overlaps, so using nudging plus repulsion as above is safer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">yy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">yy</span>, label <span class="op">=</span> <span class="va">l</span><span class="op">)</span>,</span>
<span>            position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_nudge_line.html">position_nudge_line</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>                                           formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                           x <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                                           y <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                           direction <span class="op">=</span> <span class="st">"split"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-27-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="combined-dodge-and-nudge" class="level2"><h2 class="anchored" data-anchor-id="combined-dodge-and-nudge">Combined dodge and nudge</h2>
<p>In many cases combining nudging along one plot axis and repulsion along the other axis makes it possible to constrain the randomness of the labelling in the resulting plot. Applying this approach to labelling dodged points is not possible using the position functions defined in package ‘ggplot2’. Package ‘ggpp’ defines a combined position function that “keeps” the dodged position making it possible for <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel()</a></code> to draw segments connecting the text to the dodged points.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mtcars</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span><span class="va">mtcars</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">am</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">am</span>, y <span class="op">=</span> <span class="va">mpg</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">cyl</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://docs.r4photobiology.info/ggpp/reference/position_dodgenudge.html">position_dodgenudge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>                                   y <span class="op">=</span> <span class="fl">0</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    box.padding <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"y"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cyl</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="nudge-and-repel_files/figure-html/unnamed-chunk-28-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="acknowledgements" class="level2"><h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>I warmly thank Kamil Slowikowski for agreeing to make changes in ‘ggrepel’ that make the use of ‘ggrepel’ together with ‘ggpp’ possible and smooth. This document shows some use examples, but surely new ones will be found by users of R and ‘ggplot2’.</p>
</section><section id="references" class="level2"><h2 class="anchored" data-anchor-id="references">References</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">'ggplot2'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite ggplot2 in publications, please use

  H. Wickham. ggplot2: Elegant Graphics for Data Analysis.
  Springer-Verlag New York, 2016.

A BibTeX entry for LaTeX users is

  @Book{,
    author = {Hadley Wickham},
    title = {ggplot2: Elegant Graphics for Data Analysis},
    publisher = {Springer-Verlag New York},
    year = {2016},
    isbn = {978-3-319-24277-4},
    url = {https://ggplot2.tidyverse.org},
  }</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">'ggpp'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite package 'ggpp' in publications use:

  Aphalo P (2023). _ggpp: Grammar Extensions to 'ggplot2'_. R package
  version 0.5.5, https://github.com/aphalo/ggpp,
  &lt;https://docs.r4photobiology.info/ggpp/&gt;.

A BibTeX entry for LaTeX users is

  @Manual{,
    title = {ggpp: Grammar Extensions to 'ggplot2'},
    author = {Pedro J. Aphalo},
    year = {2023},
    note = {R package version 0.5.5, 
https://github.com/aphalo/ggpp},
    url = {https://docs.r4photobiology.info/ggpp/},
  }</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">'ggrepel'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite package 'ggrepel' in publications use:

  Slowikowski K (2023). _ggrepel: Automatically Position
  Non-Overlapping Text Labels with 'ggplot2'_. R package version 0.9.4,
  &lt;https://CRAN.R-project.org/package=ggrepel&gt;.

A BibTeX entry for LaTeX users is

  @Manual{,
    title = {ggrepel: Automatically Position Non-Overlapping Text Labels with
'ggplot2'},
    author = {Kamil Slowikowski},
    year = {2023},
    note = {R package version 0.9.4},
    url = {https://CRAN.R-project.org/package=ggrepel},
  }</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">'lubridate'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite lubridate in publications use:

  Garrett Grolemund, Hadley Wickham (2011). Dates and Times Made Easy
  with lubridate. Journal of Statistical Software, 40(3), 1-25. URL
  https://www.jstatsoft.org/v40/i03/.

A BibTeX entry for LaTeX users is

  @Article{,
    title = {Dates and Times Made Easy with {lubridate}},
    author = {Garrett Grolemund and Hadley Wickham},
    journal = {Journal of Statistical Software},
    year = {2011},
    volume = {40},
    number = {3},
    pages = {1--25},
    url = {https://www.jstatsoft.org/v40/i03/},
  }</code></pre>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Nudging + repulsion with 'ggrepel' and 'ggpp'"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Directed/ordered data labels' positions avoiding overlaps"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Pedro J. Aphalo"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-02-28"</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "2023-12-12"</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span><span class="co"> [data labels, ggplot2 pkg, ggpp pkg, ggrepel pkg]</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Plotting examples]</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">  Example R code for plots with labels without overlaps but with controlled position displacements away from specific plots features such as curves and observations' density centroids.</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> false</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE}</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="in">opts_chunk$set(fig.align = 'center', </span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="in">               fig.show = 'hold', fig.width = 7, fig.height = 4)</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="in">options(warnPartialMatchArgs = FALSE,</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="in">        tibble.print.max = 4,</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="in">        tibble.print.min = 4,</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="in">        dplyr.summarise.inform = FALSE)</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>The very popular R package 'ggrepel' does a great job at avoiding</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>overlaps among data labels and between them and observations plotted as</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>points. A difficulty that stems from the use of an algorithm based on</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>random displacements is that the final location of the data labels can</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>become more disordered than desirable. In addition when including smooth</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>regression lines the data labels may partly occlude the fitted line</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>and/or the confidence band.</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>Package 'ggpp' defines new position functions that save the starting</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>position like <span class="in">`position_nudge_repel()`</span> does but come in multiple</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>flavors. Their use together with repulsive geometries from 'ggrepel'</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>makes it possible to give to the data labels an initial "push" in a</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>non-random direction. This helps a lot, much more than what I expect</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>initially, in obtaining a more orderly displacement by repulsion of the</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>data labels away from a cloud of observations or a line.</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>Because of the naming convention used, the new position functions remain</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>fully compatible with all geometries that have a formal parameter</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="in">`position`</span>. However, most examples below use geometries from packages</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>'ggrepel' or 'ggpp' to create a plot layer containing data labels as</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>currently geoms from these packages can draw connecting segments or</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>arrows between the original and displaced positions.</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>As we will use text and labels on the plotting area we change the</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>default theme to an uncluttered one.</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpp)</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="in">library(grid)</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="in"># Is a compatible version of 'ggrepel' installed?</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="in">eval_ggrepel &lt;- requireNamespace("ggrepel", quietly = TRUE) &amp;&amp;</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="in">  packageVersion("ggrepel") &gt;= "0.9.2"</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="in">if (eval_ggrepel) library(ggrepel)</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="in">old_theme &lt;- theme_set(theme_bw())</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## Position functions and nudging</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>Nudging shifts deterministically the *x* and/or *y* coordinates of an</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>observation. This takes place early enough for the limits of the</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>corresponding scales be set based on the displaced positions. In</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>'ggplot2', position functions and consequently also geometries by</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>default apply no nudging.</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>Function <span class="in">`position_nudge()`</span> from package 'ggplot2' applies the nudge, to</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>*x* and/or *y* data coordinates based directly on the values passed to</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>its parameters <span class="in">`x`</span> and <span class="in">`y`</span>. Passing arguments to the <span class="in">`nudge_x`</span> and/or</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="in">`nudge_y`</span> parameters of a geometry has the same effect, as these values</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>are passed to <span class="in">`position_nudge()`</span> within the geometry's code. Geometries</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>also have a <span class="in">`position`</span> parameter to which we can pass an expression</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>based on a *position function* which opens the door to more elaborate</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>approaches to nudging, as well as allowing other changes in coordinates</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>such as stacking.</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`geom_point_s()`</span> to exemplify what nudging does. The</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>black dots are the original positions and the red ones the nudged</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>positions, with the arrows of length 0.5 along _x_, showing the displacement</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>and its direction.</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)), <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point_s</span>(<span class="at">nudge_x =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>Function <span class="in">`position_nudge_keep()`</span> keeps a copy of the original position making it</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>possible for geometries like <span class="in">`geom_point_s()`</span> to draw connecting segments or</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>arrows.</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>Package 'ggpp' provides several new position functions to facilitate nudging.</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>All of them keep the original positions to allow links to be drawn. Some of</span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>them, just simplify some use cases, e.g., <span class="in">`position_nudge_to()`</span>, which accepts</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>the desired nudged coordinates directly, instead of as a displacement away from</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>the initial position. This allows to push data labels away from observations</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>into a row or column.</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>Other new position functions compute the nudge for individual observations based</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>on different criteria. For example by nudging away from a focal point, a line or</span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>a curve. The focal point or line can be either supplied directly or fitted to</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>the observations. In <span class="in">`position_nudge_center()`</span> and <span class="in">`position_nudge_line()`</span></span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>described below, this reference alters only the direction (angle) along which</span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a>nudge is applied but not the extent of the shift. Advanced nudging works very</span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a>well, but only for some patterns of observations and may require manual</span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>adjustment of positions, repulsion is more generally applicable but like</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>jittering is aleatory. Combining nudging and repulsion we can make repulsion</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>more predictable with little loss of its applicability.</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>These position functions can be used with any geometry but if segments joining</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>the nudged positions to the original ones are desired, only geometries from</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>packages 'ggrepel' or 'ggpp' can currently be used. Geometries</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_text_repel()`</span> or <span class="in">`geom_label_repel()`</span> from 'ggrepel' should be used when</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>repulsion is desired. Setting <span class="in">`max.iter = 0`</span> in these functions disables</span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>repulsion but allows the drawing of segments or arrows. Alternatively, several</span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a>geometries from 'ggpp' implement the drawing of connecting segments, but none</span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>of them implement repulsion. Please see</span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>the documentation for the different geometries from packages 'ggrepel' and</span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>'ggpp' for the details.</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>As mentioned above, drawing of segments or arrows is made possible by position</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>functions storing in <span class="in">`data`</span> both the nudged and original *x* and *y*</span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>coordinates. The joint use of 'ggrepel' and 'ggpp' was made possible by</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>coordinated development of these packages and agreement on a naming convention</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>for storing the original position. Keeping both nudged and original positions</span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>increases the size of the data, and consequently also the size of the ggplot</span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a>objects. Because of this, the position functions from 'ggpp' allow the keeping </span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>of the original positions to be disabled when needed.</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connecting segments and arrows</span></span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a>Function <span class="in">`position_nudge_keep()`</span> is like <span class="in">`ggplot2::position_nudge()`</span> but</span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a>keeps (stores) the original *x* and *y* coordinates. It is similar to</span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a>function <span class="in">`position_nudge_repel()`</span> but uses a different naming convention</span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a>for the coordinates. Both work with <span class="in">`geom_text_repel()`</span> or</span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_label_repel()`</span> from package 'ggrepel' (<span class="sc">\&gt;</span>= 0.9.2), but only</span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a><span class="in">`position_nudge_keep()`</span> can be used interchangeably with</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2::position_nudge()`</span> with other geometries such as <span class="in">`geom_text()`</span>.</span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">84532</span>)</span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>),</span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> <span class="fu">paste</span>(<span class="st">"label:"</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a>With <span class="in">`position_nudge_keep()`</span> from 'ggpp' used together with</span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_text_repel()`</span> or <span class="in">`geom_label_repel()`</span> segments between a nudged</span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a>and/or repelled label and the original position (here indicated by a</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a>point) are drawn. As shown here, passing <span class="in">`max.iter = 0`</span> disables</span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a>repulsion.</span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = position_nudge_keep(x = 0.3),</span></span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a><span class="in">                  max.iter = 0)</span></span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## PCA loadings</span></span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a>A usually more problematic example is the labeling of loadings in PCA</span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a>and similar biplots.</span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a><span class="in">## Example data frame where each species' principal components have been computed.</span></span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a><span class="in">df1 &lt;- data.frame(</span></span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a><span class="in">  Species = paste("Species",1:5),</span></span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a><span class="in">  PC1     = c(-4, -3.5, 1, 2, 3),</span></span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a><span class="in">  PC2     = c(-1, -1, 0, -0.5, 0.7)) </span></span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df1, aes(x=PC1, y = PC2, label = Species, colour = Species)) +</span></span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(aes(yintercept = 0), linewidth = .2) +</span></span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(aes(xintercept = 0), linewidth = .2) +</span></span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), </span></span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a><span class="in">               arrow = arrow(length = unit(0.1, "inches"))) +</span></span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_label_repel(position = position_nudge_center(x = 0.2, y = 0.01,</span></span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    center_x = 0, center_y = 0),</span></span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a><span class="in">                   label.size = NA,</span></span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a><span class="in">                   label.padding = 0.1,</span></span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a><span class="in">                   fill = rgb(red = 1, green = 1, blue = 1, alpha = 0.75)) +</span></span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(-5, 5) +</span></span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(-2, 2) +</span></span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a><span class="in">  # Stadard settings for displaying biplots</span></span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_fixed() +</span></span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aligned data labels</span></span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-211"><a href="#cb36-211" aria-hidden="true" tabindex="-1"></a>Function <span class="in">`position_nudge_to()`</span> nudges to a given position instead of</span>
<span id="cb36-212"><a href="#cb36-212" aria-hidden="true" tabindex="-1"></a>using the same shift for each observation. It can be used to align labels</span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a>for points that are not themselves aligned.</span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-216"><a href="#cb36-216" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = ifelse(x &lt; 0.5, "", l) )) +</span></span>
<span id="cb36-217"><a href="#cb36-217" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_to(x = 2.3),</span></span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0,</span></span>
<span id="cb36-221"><a href="#cb36-221" aria-hidden="true" tabindex="-1"></a><span class="in">                  segment.color = "red",</span></span>
<span id="cb36-222"><a href="#cb36-222" aria-hidden="true" tabindex="-1"></a><span class="in">                  arrow = arrow(length = unit(0.015, "npc")),</span></span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a><span class="in">                  direction = "y") +</span></span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a><span class="in">  expand_limits(x = 3)</span></span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>By providing two values for nudging with opposite sign, we can add labels</span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a>alternating between sides. We use here <span class="in">`geom_text_s()`</span> but other geometries</span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>could have been used as well. How the data labels been closer together repulsion</span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>would have been needed in addition to nudging.</span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a>size_from_area <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">sqrt</span>(<span class="fu">max</span>(<span class="dv">0</span>, x) <span class="sc">/</span> pi)}</span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">b =</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">10</span>)))</span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="dv">1</span>, b, <span class="at">size =</span> b)) <span class="sc">+</span> </span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_s</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(b,<span class="dv">2</span>)),</span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_nudge_to</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">0.9</span>)),</span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>              <span class="at">box.padding =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>() <span class="sc">+</span></span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb36-247"><a href="#cb36-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-248"><a href="#cb36-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a>It is also useful when labeling curves than end at different positions along</span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a>the *x* axis. In this example we avoid overlaps with repulsion along the _y_</span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a>axis. The data set used in this example is dynamic, so we use nudging to a</span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a>position that is dynamicaly computed from the data.</span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a><span class="in">keep &lt;- c("Israel", "United States", "European Union", "China", "South Africa", "Qatar",</span></span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a><span class="in">          "Argentina", "Chile", "Brazil", "Ukraine", "Indonesia", "Bangladesh")</span></span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- read.csv("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/vaccinations.csv")</span></span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a><span class="in">data$date &lt;- ymd(data$date)</span></span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;%</span></span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(location %in% keep) %&gt;%</span></span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a><span class="in">  select(location, date, total_vaccinations_per_hundred) %&gt;%</span></span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(location, date) %&gt;%</span></span>
<span id="cb36-265"><a href="#cb36-265" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(total_vaccinations_per_hundred)) %&gt;%</span></span>
<span id="cb36-266"><a href="#cb36-266" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(location = factor(location),</span></span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a><span class="in">         location = reorder(location, total_vaccinations_per_hundred)) %&gt;%</span></span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(location) %&gt;% # max(date) depends on the location!</span></span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(label = if_else(date == max(date), </span></span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a><span class="in">                         as.character(location), </span></span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a><span class="in">                         "")) -&gt; owid</span></span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(owid,</span></span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = date, </span></span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a><span class="in">           y = total_vaccinations_per_hundred,</span></span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a><span class="in">           color = location)) +</span></span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line() +</span></span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(aes(label = label),</span></span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 3,</span></span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a><span class="in">                  position = position_nudge_to(x = as.numeric(max(owid$date) + days(50))),</span></span>
<span id="cb36-281"><a href="#cb36-281" aria-hidden="true" tabindex="-1"></a><span class="in">                  segment.color = 'grey',</span></span>
<span id="cb36-282"><a href="#cb36-282" aria-hidden="true" tabindex="-1"></a><span class="in">                  point.size = 0,</span></span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a><span class="in">                  box.padding = 0.1,</span></span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a><span class="in">                  point.padding = 0.1,</span></span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a><span class="in">                  hjust = "left",</span></span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a><span class="in">                  direction = "y") + </span></span>
<span id="cb36-287"><a href="#cb36-287" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(expand = expansion(mult = c(0.05, 0.2))) +</span></span>
<span id="cb36-288"><a href="#cb36-288" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Cumulative COVID-19 vaccination doses administered per 100 people",</span></span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "",</span></span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Date (year-month)") +</span></span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a>In the call to <span class="in">`position_nudge_to()`</span> we passed a vector of length one as</span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a>argument for <span class="in">`x`</span>, but both <span class="in">`x`</span> and <span class="in">`y`</span> also accept longer vectors. In other</span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a>words, this position function makes it possible manual positioning of text and</span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a>labels.</span>
<span id="cb36-299"><a href="#cb36-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-300"><a href="#cb36-300" aria-hidden="true" tabindex="-1"></a>In the next example we decrease the forces used for repulsion and the</span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a>padding so that the labels remain close together. In this way, we can</span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a>label the observations on the rug of a combined point and rug plot.</span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = round(x, 2))) +</span></span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 3) +</span></span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = position_nudge_to(y = -2.7), </span></span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 3,</span></span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a><span class="in">            angle = 90,</span></span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0,</span></span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a><span class="in">            box.padding = 0.05,</span></span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a><span class="in">            min.segment.length = Inf,</span></span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a><span class="in">            direction = "x",</span></span>
<span id="cb36-314"><a href="#cb36-314" aria-hidden="true" tabindex="-1"></a><span class="in">            force = 0.1,</span></span>
<span id="cb36-315"><a href="#cb36-315" aria-hidden="true" tabindex="-1"></a><span class="in">            force_pull = 0.1) +</span></span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_rug(sides = "b", length = unit(0.02, "npc"))</span></span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-319"><a href="#cb36-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clouds of observations</span></span>
<span id="cb36-320"><a href="#cb36-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a>In many cases data are distributed as a cloud with decreasing density towards</span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a>edges. In some other cases, even with evely distributed observations, a certain</span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a>partly systematic pattern of displacement of data labels is visually more</span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>attractive than a fully random one. In both cases, combining nudging and</span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a>repulsion is usually an effective approach.</span>
<span id="cb36-326"><a href="#cb36-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-327"><a href="#cb36-327" aria-hidden="true" tabindex="-1"></a>In this example we use repulsion with nudging away from zero. In all cases</span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a>nudging shifts the coordinates giving a new *x* and/or *y* position that expands</span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a>the limits of the corresponding scales to include the nudged coordinate values,</span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a>but not necessarily the whole of justified text or labels.</span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed") +</span></span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.3, center_x = 0),</span></span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0)</span></span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-341"><a href="#cb36-341" aria-hidden="true" tabindex="-1"></a>We set a different split point as the value computed by a function</span>
<span id="cb36-342"><a href="#cb36-342" aria-hidden="true" tabindex="-1"></a>function, by name.</span>
<span id="cb36-343"><a href="#cb36-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-344"><a href="#cb36-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-346"><a href="#cb36-346" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(aes(xintercept = median(x)), linetype = "dashed") +</span></span>
<span id="cb36-347"><a href="#cb36-347" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-348"><a href="#cb36-348" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-349"><a href="#cb36-349" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.3, center_x = median),</span></span>
<span id="cb36-350"><a href="#cb36-350" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0)</span></span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-353"><a href="#cb36-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-354"><a href="#cb36-354" aria-hidden="true" tabindex="-1"></a>We set a different split point as the value computed by an anonymous</span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a>function. Here we split on the first quartile along *x* and _y_ = 2.</span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-357"><a href="#cb36-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-358"><a href="#cb36-358" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.3,</span></span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a><span class="in">                                          center_x = function(x) {</span></span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a><span class="in">                                            quantile(x, </span></span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     probs = 1/4, </span></span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     names = FALSE)</span></span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a><span class="in">                                          },</span></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a><span class="in">                                          direction = "split"),</span></span>
<span id="cb36-368"><a href="#cb36-368" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0)</span></span>
<span id="cb36-369"><a href="#cb36-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a>By requesting nudging along *x* and *y* and setting <span class="in">`direction = "split"`</span></span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a>nudging is applied according to the quadrants centred on the centroid of the</span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a>data.</span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.1,</span></span>
<span id="cb36-380"><a href="#cb36-380" aria-hidden="true" tabindex="-1"></a><span class="in">                                          y = 0.15,</span></span>
<span id="cb36-381"><a href="#cb36-381" aria-hidden="true" tabindex="-1"></a><span class="in">                                          direction = "split"))</span></span>
<span id="cb36-382"><a href="#cb36-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-383"><a href="#cb36-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a>With <span class="in">`direction = "radial"`</span>, the distance nudged away from the center is</span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a>the same for all labels.</span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-389"><a href="#cb36-389" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-390"><a href="#cb36-390" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-391"><a href="#cb36-391" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.25,</span></span>
<span id="cb36-392"><a href="#cb36-392" aria-hidden="true" tabindex="-1"></a><span class="in">                                          y = 0.4,</span></span>
<span id="cb36-393"><a href="#cb36-393" aria-hidden="true" tabindex="-1"></a><span class="in">                                          direction = "radial"),</span></span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0)</span></span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a>We can also set the justification of the text labels although repulsion</span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a>usually works best with labels justified at the centre, which is the</span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a>default in <span class="in">`geom_text_repel()`</span>. </span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.25,</span></span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a><span class="in">                                          y = 0.25,</span></span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a><span class="in">                                          center_x = 0,</span></span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a><span class="in">                                          center_y = 2,</span></span>
<span id="cb36-409"><a href="#cb36-409" aria-hidden="true" tabindex="-1"></a><span class="in">                                          direction = "radial"),</span></span>
<span id="cb36-410"><a href="#cb36-410" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0,</span></span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a><span class="in">                  hjust = "outward", vjust = "outward") +</span></span>
<span id="cb36-412"><a href="#cb36-412" aria-hidden="true" tabindex="-1"></a><span class="in">  expand_limits(x = c(-2.7, +2.3))</span></span>
<span id="cb36-413"><a href="#cb36-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a>Nudging along one axis, here *x*, and setting the repulsion <span class="in">`direction`</span></span>
<span id="cb36-416"><a href="#cb36-416" aria-hidden="true" tabindex="-1"></a>along the other axis, here *y*, tends to give a pleasant arrangement of</span>
<span id="cb36-417"><a href="#cb36-417" aria-hidden="true" tabindex="-1"></a>labels.</span>
<span id="cb36-418"><a href="#cb36-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-419"><a href="#cb36-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(position = </span></span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a><span class="in">                    position_nudge_center(x = 0.2,</span></span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a><span class="in">                                          center_x = 0,</span></span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a><span class="in">                                          direction = "split"),</span></span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a><span class="in">                  aes(hjust = "outward"),</span></span>
<span id="cb36-427"><a href="#cb36-427" aria-hidden="true" tabindex="-1"></a><span class="in">                  direction = "y",</span></span>
<span id="cb36-428"><a href="#cb36-428" aria-hidden="true" tabindex="-1"></a><span class="in">                  min.segment.length = 0) +</span></span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a><span class="in">  expand_limits(x = c(-3, 3))</span></span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a>When some regions have a high density of observations we may wish to only</span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a>label those in the lower density regions. To automate this, we can use</span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a>statistics <span class="in">`stat_dens2d_labels()`</span> or <span class="in">`stat_dens1d_labels()`</span> that replace</span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a>the labels with <span class="in">`""`</span> but retain all rows in data so that repulsion away</span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a>from all points is achieved. In contrast, <span class="in">`stat_dens2d_filter()`</span> or </span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a><span class="in">`stat_dens1d_filter()`</span> subset <span class="in">`data`</span> using identical criteria.</span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, y, label = l)) +</span></span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_dens2d_labels(geom = "text_repel",</span></span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a><span class="in">                     keep.fraction = 1/2,</span></span>
<span id="cb36-445"><a href="#cb36-445" aria-hidden="true" tabindex="-1"></a><span class="in">                     position = </span></span>
<span id="cb36-446"><a href="#cb36-446" aria-hidden="true" tabindex="-1"></a><span class="in">                       position_nudge_center(x = 0.2,</span></span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a><span class="in">                                             center_x = 0,</span></span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a><span class="in">                                             direction = "split"),</span></span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(hjust = ifelse(x &lt; 0, 1, 0)),</span></span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a><span class="in">                     direction = "y",</span></span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a><span class="in">                     min.segment.length = 0) +</span></span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_dens2d_filter(geom = "point",</span></span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a><span class="in">                     keep.fraction = 1/2,</span></span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a><span class="in">                     shape = "circle open", size = 3) +</span></span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a><span class="in">  expand_limits(x = c(-3, 3))</span></span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a>We create a set of example data with a denser distribution.</span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a>random_string <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">len =</span> <span class="dv">3</span>) {</span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">sample</span>(letters, len, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">collapse =</span> <span class="st">""</span>)</span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Make random data.</span></span>
<span id="cb36-468"><a href="#cb36-468" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb36-469"><a href="#cb36-469" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>),</span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>),</span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>)),</span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab =</span> <span class="fu">replicate</span>(<span class="dv">100</span>, { <span class="fu">random_string</span>() })</span>
<span id="cb36-474"><a href="#cb36-474" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-475"><a href="#cb36-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-477"><a href="#cb36-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-478"><a href="#cb36-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = d, aes(x, y, label = lab, colour = group)) +</span></span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_dens2d_labels(geom = "text_repel", </span></span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a><span class="in">                     keep.fraction = 0.45,</span></span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a><span class="in">                     min.segment.length = 0)</span></span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>With <span class="in">`geom_label_repel`</span> one usually needs to use a smaller value for</span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a><span class="in">`keep.fracton`</span>, or a smaller <span class="in">`size`</span>, as labels use more space on the</span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a>plot than the test alone.</span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a>Additional arguments can be used to change the angle and position of the</span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a>text, but may give unexpected output when labels are long as the</span>
<span id="cb36-492"><a href="#cb36-492" aria-hidden="true" tabindex="-1"></a>repulsion algorithm "sees" always a rectangular bounding box that is not</span>
<span id="cb36-493"><a href="#cb36-493" aria-hidden="true" tabindex="-1"></a>rotated. With short labels or angles that are multiples of 90 degrees,</span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a>there is no such problem. Please, see the documentation for</span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a><span class="in">`ggrepel::geom_text_repel`</span> and <span class="in">`ggrepel::geom_label_repel`</span> for the</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a>various ways in which both repulsion and formatting of the labels can be</span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a>adjusted.</span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`NA`</span> as argument to <span class="in">`label.fill`</span> makes the observations with</span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a>labels set to <span class="in">`NA`</span> *incomplete*, and such rows in data are skipped when</span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>rendering the plot, before the repulsion algorithm is active. This can</span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>lead to overlap between text and points corresponding to unlabelled</span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>observations. Whether points are occluded depends on the order of layers</span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>and transparency, the occlusion can remain easily unnoticed with</span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_label`</span> and <span class="in">`geom_label_repel`</span>. We keep <span class="in">`geom_point`</span> as the topmost</span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a>layer to ensure that all observations are visible.</span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = d, aes(x, y, label = lab, colour = group)) +</span></span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_dens2d_labels(geom = "label_repel", </span></span>
<span id="cb36-511"><a href="#cb36-511" aria-hidden="true" tabindex="-1"></a><span class="in">                     keep.fraction = 0.2, </span></span>
<span id="cb36-512"><a href="#cb36-512" aria-hidden="true" tabindex="-1"></a><span class="in">                     label.fill = NA) +</span></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point()</span></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a>The 1D versions work similarly but assess the density along only one of</span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a>_x_ or _y_. In other respects than <span class="in">`orientation`</span> and the parameters passed</span>
<span id="cb36-518"><a href="#cb36-518" aria-hidden="true" tabindex="-1"></a>internally to <span class="in">`stats::density()`</span> the examples given earlier for</span>
<span id="cb36-519"><a href="#cb36-519" aria-hidden="true" tabindex="-1"></a><span class="in">`stat_dens2d_labels()`</span> also apply <span class="in">`stat_dens1d_labels()`</span>.</span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a>An example for a plot based on an enhancement suggested in an issue raised at</span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a>GitHub by Michael Schubert, made possible by parameter <span class="in">`keep.these`</span> added for</span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a>this and similar use cases.</span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpp)</span>
<span id="cb36-530"><a href="#cb36-530" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb36-531"><a href="#cb36-531" aria-hidden="true" tabindex="-1"></a>syms <span class="ot">=</span> <span class="fu">c</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">=</span> <span class="fu">do.call</span>(paste0, <span class="fu">expand.grid</span>(syms, syms))</span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a>dset <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">rnorm</span>(<span class="fl">1e3</span>), <span class="at">y=</span><span class="fu">rnorm</span>(<span class="fl">1e3</span>), <span class="at">label=</span><span class="fu">sample</span>(labs, <span class="fl">1e3</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dset, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">"grey85"</span>) <span class="sc">+</span></span>
<span id="cb36-541"><a href="#cb36-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dens2d_filter</span>(<span class="at">geom =</span> <span class="st">"text_repel"</span>,</span>
<span id="cb36-542"><a href="#cb36-542" aria-hidden="true" tabindex="-1"></a>                     <span class="at">position =</span> <span class="fu">position_nudge_centre</span>(<span class="at">x =</span> <span class="fl">0.1</span>, </span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">y =</span> <span class="fl">0.1</span>, </span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">direction =</span> <span class="st">"radial"</span>),</span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a>                     <span class="at">keep.number =</span> <span class="dv">50</span>,</span>
<span id="cb36-546"><a href="#cb36-546" aria-hidden="true" tabindex="-1"></a>                     <span class="at">keep.these =</span> <span class="fu">c</span>(<span class="st">"aA"</span>, <span class="st">"bB"</span>, <span class="st">"cC"</span>),</span>
<span id="cb36-547"><a href="#cb36-547" aria-hidden="true" tabindex="-1"></a>                     <span class="at">min.segment.length =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lines, curves and observations along them</span></span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a>Function <span class="in">`position_nudge_line()`</span> nudges away from a line, which can be a</span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a>user supplied straight line as well as a smooth spline or a polynomial</span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a>fitted to the observations themselves. The nudging is away and</span>
<span id="cb36-556"><a href="#cb36-556" aria-hidden="true" tabindex="-1"></a>perpendicular to the local slope of the straight or curved line. It</span>
<span id="cb36-557"><a href="#cb36-557" aria-hidden="true" tabindex="-1"></a>relies on the same assumptions as linear regression, assuming that *x*</span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a>values are not subject to error. This in most cases prevents labels from</span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a>overlapping a curve fitted to the data, even if not exactly based on the</span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a>same model fit. When observations are sparse, this may be enough to</span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a>obtain a nice arrangement of data labels, otherwise, it can be used in</span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a>combination with repulsive geometries. </span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-566"><a href="#cb36-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16532</span>)</span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> (<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb36-571"><a href="#cb36-571" aria-hidden="true" tabindex="-1"></a>  <span class="at">yy =</span> (<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">21</span>, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb36-572"><a href="#cb36-572" aria-hidden="true" tabindex="-1"></a>  <span class="at">yyy =</span> (<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">21</span>, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>]</span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-576"><a href="#cb36-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-577"><a href="#cb36-577" aria-hidden="true" tabindex="-1"></a>We use a repulsive geometry when the label texts are long or the labels are</span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a>crowded near the line. Combining repulsion and computed nudging is effective.</span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x, yy)) +</span></span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_smooth(method = "loess", formula = y ~ x) +</span></span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_label_repel(aes(y = yy, label = paste("point", l)),</span></span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a><span class="in">                   size = 3,</span></span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a><span class="in">                   position = position_nudge_line(x = 0.9, </span></span>
<span id="cb36-587"><a href="#cb36-587" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  y = 8,</span></span>
<span id="cb36-588"><a href="#cb36-588" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  direction = "split"),</span></span>
<span id="cb36-589"><a href="#cb36-589" aria-hidden="true" tabindex="-1"></a><span class="in">                   box.padding = 0.3,</span></span>
<span id="cb36-590"><a href="#cb36-590" aria-hidden="true" tabindex="-1"></a><span class="in">                   min.segment.length = 0) +</span></span>
<span id="cb36-591"><a href="#cb36-591" aria-hidden="true" tabindex="-1"></a><span class="in">  expand_limits(x = c(-12, 12))</span></span>
<span id="cb36-592"><a href="#cb36-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-593"><a href="#cb36-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-594"><a href="#cb36-594" aria-hidden="true" tabindex="-1"></a>::: callout-hint</span>
<span id="cb36-595"><a href="#cb36-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-596"><a href="#cb36-596" aria-hidden="true" tabindex="-1"></a>When fitting a polynomial, <span class="in">`"lm"`</span> should be the argument passed to</span>
<span id="cb36-597"><a href="#cb36-597" aria-hidden="true" tabindex="-1"></a><span class="in">`method`</span> and a model formula preferably based on <span class="in">`poly()`</span>, setting</span>
<span id="cb36-598"><a href="#cb36-598" aria-hidden="true" tabindex="-1"></a><span class="in">`raw = TRUE`</span>, as argument to <span class="in">`formula`</span>.</span>
<span id="cb36-599"><a href="#cb36-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-600"><a href="#cb36-600" aria-hidden="true" tabindex="-1"></a>*Currently no other methods are implemented in* <span class="in">`position_nudge_line()`</span>.</span>
<span id="cb36-601"><a href="#cb36-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-602"><a href="#cb36-602" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-603"><a href="#cb36-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-604"><a href="#cb36-604" aria-hidden="true" tabindex="-1"></a>In the case of data labels that are small, a single character in the next</span>
<span id="cb36-605"><a href="#cb36-605" aria-hidden="true" tabindex="-1"></a>example, we also benefit from nudging if they are near a fitted line. </span>
<span id="cb36-606"><a href="#cb36-606" aria-hidden="true" tabindex="-1"></a>Nudging plus repulsion, shown next, will be compared to</span>
<span id="cb36-607"><a href="#cb36-607" aria-hidden="true" tabindex="-1"></a>alternatives. In this case we assume no linking segments are desired as</span>
<span id="cb36-608"><a href="#cb36-608" aria-hidden="true" tabindex="-1"></a>there is enough space for the data labels to remain near the observations.</span>
<span id="cb36-609"><a href="#cb36-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-612"><a href="#cb36-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-613"><a href="#cb36-613" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, yy)) <span class="sc">+</span></span>
<span id="cb36-614"><a href="#cb36-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-615"><a href="#cb36-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb36-616"><a href="#cb36-616" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb36-617"><a href="#cb36-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">y =</span> yy, <span class="at">label =</span> l),</span>
<span id="cb36-618"><a href="#cb36-618" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_nudge_line</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb36-619"><a href="#cb36-619" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-620"><a href="#cb36-620" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">x =</span> <span class="fl">0.5</span>, </span>
<span id="cb36-621"><a href="#cb36-621" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">y =</span> <span class="dv">5</span>,</span>
<span id="cb36-622"><a href="#cb36-622" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">direction =</span> <span class="st">"split"</span>),</span>
<span id="cb36-623"><a href="#cb36-623" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding =</span> <span class="fl">0.25</span>,</span>
<span id="cb36-624"><a href="#cb36-624" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min.segment.length =</span> <span class="cn">Inf</span>)</span>
<span id="cb36-625"><a href="#cb36-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-626"><a href="#cb36-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-627"><a href="#cb36-627" aria-hidden="true" tabindex="-1"></a>Using nudging alone there is little difference, but there is always the posibility of</span>
<span id="cb36-628"><a href="#cb36-628" aria-hidden="true" tabindex="-1"></a>overlaps, so using nudging plus repulsion as above is safer. </span>
<span id="cb36-629"><a href="#cb36-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-632"><a href="#cb36-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-633"><a href="#cb36-633" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, yy)) <span class="sc">+</span></span>
<span id="cb36-634"><a href="#cb36-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-635"><a href="#cb36-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, </span>
<span id="cb36-636"><a href="#cb36-636" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb36-637"><a href="#cb36-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> yy, <span class="at">label =</span> l),</span>
<span id="cb36-638"><a href="#cb36-638" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge_line</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb36-639"><a href="#cb36-639" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-640"><a href="#cb36-640" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">x =</span> <span class="fl">0.5</span>, </span>
<span id="cb36-641"><a href="#cb36-641" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">y =</span> <span class="dv">5</span>,</span>
<span id="cb36-642"><a href="#cb36-642" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">direction =</span> <span class="st">"split"</span>))</span>
<span id="cb36-643"><a href="#cb36-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-644"><a href="#cb36-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-645"><a href="#cb36-645" aria-hidden="true" tabindex="-1"></a><span class="fu">## Combined dodge and nudge</span></span>
<span id="cb36-646"><a href="#cb36-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-647"><a href="#cb36-647" aria-hidden="true" tabindex="-1"></a>In many cases combining nudging along one plot axis and repulsion along the other axis makes it possible to constrain the randomness of the labelling in the resulting plot. Applying this approach to labelling dodged points is not possible using the position functions defined in package 'ggplot2'. Package 'ggpp' defines a combined position function that "keeps" the dodged position making it possible for <span class="in">`geom_text_repel()`</span> to draw segments connecting the text to the dodged points.</span>
<span id="cb36-648"><a href="#cb36-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-649"><a href="#cb36-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=eval_ggrepel}</span></span>
<span id="cb36-650"><a href="#cb36-650" aria-hidden="true" tabindex="-1"></a><span class="in">mtcars &lt;- mtcars</span></span>
<span id="cb36-651"><a href="#cb36-651" aria-hidden="true" tabindex="-1"></a><span class="in">mtcars$cyl &lt;- factor(mtcars$cyl)</span></span>
<span id="cb36-652"><a href="#cb36-652" aria-hidden="true" tabindex="-1"></a><span class="in">mtcars$am &lt;- factor(mtcars$am)</span></span>
<span id="cb36-653"><a href="#cb36-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-654"><a href="#cb36-654" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(mtcars, aes(x = am, y = mpg, label = format(mpg, 3))) +</span></span>
<span id="cb36-655"><a href="#cb36-655" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_repel(</span></span>
<span id="cb36-656"><a href="#cb36-656" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(group = cyl),</span></span>
<span id="cb36-657"><a href="#cb36-657" aria-hidden="true" tabindex="-1"></a><span class="in">    position = position_dodgenudge(width = 0.9, </span></span>
<span id="cb36-658"><a href="#cb36-658" aria-hidden="true" tabindex="-1"></a><span class="in">                                   y = 0, x = c(-0.1, 0.1)),</span></span>
<span id="cb36-659"><a href="#cb36-659" aria-hidden="true" tabindex="-1"></a><span class="in">    box.padding = 0.15,</span></span>
<span id="cb36-660"><a href="#cb36-660" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb36-661"><a href="#cb36-661" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.9,</span></span>
<span id="cb36-662"><a href="#cb36-662" aria-hidden="true" tabindex="-1"></a><span class="in">    min.segment.length = 0,</span></span>
<span id="cb36-663"><a href="#cb36-663" aria-hidden="true" tabindex="-1"></a><span class="in">    direction = "y"</span></span>
<span id="cb36-664"><a href="#cb36-664" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb36-665"><a href="#cb36-665" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb36-666"><a href="#cb36-666" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(color = cyl),</span></span>
<span id="cb36-667"><a href="#cb36-667" aria-hidden="true" tabindex="-1"></a><span class="in">    position = position_dodge(width = 0.9),</span></span>
<span id="cb36-668"><a href="#cb36-668" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 3,</span></span>
<span id="cb36-669"><a href="#cb36-669" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.5</span></span>
<span id="cb36-670"><a href="#cb36-670" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb36-671"><a href="#cb36-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-672"><a href="#cb36-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-673"><a href="#cb36-673" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgements</span></span>
<span id="cb36-674"><a href="#cb36-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-675"><a href="#cb36-675" aria-hidden="true" tabindex="-1"></a>I warmly thank Kamil Slowikowski for agreeing to make changes in</span>
<span id="cb36-676"><a href="#cb36-676" aria-hidden="true" tabindex="-1"></a>'ggrepel' that make the use of 'ggrepel' together with 'ggpp' possible</span>
<span id="cb36-677"><a href="#cb36-677" aria-hidden="true" tabindex="-1"></a>and smooth. This document shows some use examples, but surely new ones</span>
<span id="cb36-678"><a href="#cb36-678" aria-hidden="true" tabindex="-1"></a>will be found by users of R and 'ggplot2'.</span>
<span id="cb36-679"><a href="#cb36-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-680"><a href="#cb36-680" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb36-681"><a href="#cb36-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-684"><a href="#cb36-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-685"><a href="#cb36-685" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">'ggplot2'</span>)</span>
<span id="cb36-686"><a href="#cb36-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-687"><a href="#cb36-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-690"><a href="#cb36-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-691"><a href="#cb36-691" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">'ggpp'</span>)</span>
<span id="cb36-692"><a href="#cb36-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-693"><a href="#cb36-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-696"><a href="#cb36-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-697"><a href="#cb36-697" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">'ggrepel'</span>)</span>
<span id="cb36-698"><a href="#cb36-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-699"><a href="#cb36-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-702"><a href="#cb36-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-703"><a href="#cb36-703" aria-hidden="true" tabindex="-1"></a><span class="fu">citation</span>(<span class="st">'lubridate'</span>)</span>
<span id="cb36-704"><a href="#cb36-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0003-3385-972X">
<p>P. J. Aphalo @ ORCID</p>
</a>
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 ISSN 2343-3248 (Helsinki, Finland)
  </li>  
</ul>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../about/about.html">
<p>© 2015-2023 Pedro J. Aphalo</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>