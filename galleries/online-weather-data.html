<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.544">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Pedro J. Aphalo">
<meta name="dcterms.date" content="2023-07-31">
<meta name="keywords" content="R packages, weather data">
<title>Using R for Photobiology - Open Access Weather and Climate Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../r4p-favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../r4p-logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Using R for Photobiology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../posts.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages.html"> <i class="bi bi-file-richtext" role="img">
</i> 
<span class="menu-text">Pages</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../galleries.html"> <i class="bi bi-images" role="img">
</i> 
<span class="menu-text">R gallery</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-packages" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-box-seam" role="img">
</i> 
 <span class="menu-text">R packages</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-r-packages">
<li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/"><i class="bi bi-list" role="img">
</i> 
 <span class="dropdown-text">Documentation Index</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://r.r4photobiology.info/"><i class="bi bi-cloud-download" role="img">
</i> 
 <span class="dropdown-text">CRAN-like repository</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/learnrbook/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">learnrbook</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/ggpmisc-intro.html"><i class="bi bi-stack" role="img">
</i> 
 <span class="dropdown-text">Intro <em>‘ggpmisc’, ‘ggpp’ and ‘gginnards’</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggpmisc/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggpmisc</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggpp/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggpp</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/gginnards/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">gginnards</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/r4p-introduction.html"><i class="bi bi-sun" role="img">
</i> 
 <span class="dropdown-text">Intro <em>R for Photobiology Suite</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiology/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ggspectra/"><i class="bi bi-layers" role="img">
</i> 
 <span class="dropdown-text">ggspectra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyWavebands/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyWavebands</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyInOut/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyInOut</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/ooacquire/"><i class="bi bi-rulers" role="img">
</i> 
 <span class="dropdown-text">ooacquire</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/rOmniDriver/"><i class="bi bi-rulers" role="img">
</i> 
 <span class="dropdown-text">rOmniDriver</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyPlants/"><i class="bi bi-box-seam" role="img">
</i> 
 <span class="dropdown-text">photobiologyPlants</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyLamps/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyLamps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyLEDs/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyLEDs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologySun/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologySun</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologyFilters/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologyFilters</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.r4photobiology.info/photobiologySensors/"><i class="bi bi-archive" role="img">
</i> 
 <span class="dropdown-text">photobiologySensors</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../pages/packages-status.html"><i class="bi bi-check-all" role="img">
</i> 
 <span class="dropdown-text">Checks and issues</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Books</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-books">
<li>
    <a class="dropdown-item" href="https://www.learnr-book.info/"><i class="bi bi-book" role="img">
</i> 
 <span class="dropdown-text">Book <em>Learn R - As a Language</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/beyond-the-visible.html"><i class="bi bi-book" role="img">
</i> 
 <span class="dropdown-text">Handbook <em>Beyond the Visible</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/r4p-book.html"><i class="bi bi-book-half" role="img">
</i> 
 <span class="dropdown-text">Book <em>R for Photobiology</em></span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person" role="img">
</i> 
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">
<li>
    <a class="dropdown-item" href="../about/help.html"><i class="bi bi-question-square" role="img">
</i> 
 <span class="dropdown-text">Site Help</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../about/about.html"><i class="bi bi-pc-display" role="img">
</i> 
 <span class="dropdown-text">About <em>this site</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../about/pedro.html"><i class="bi bi-person" role="img">
</i> 
 <span class="dropdown-text">About <em>Pedro J. Aphalo</em></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/aphalo/r4p-blog/"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Source of <em>this site</em> at GitHub</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rss-feeds" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text">RSS feeds</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-rss-feeds">
<li>
    <a class="dropdown-item" href="../posts.xml"><i class="bi bi-newspaper" role="img">
</i> 
 <span class="dropdown-text">Blog RSS feed</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages.xml"><i class="bi bi-file-richtext" role="img">
</i> 
 <span class="dropdown-text">Pages RSS feed</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../galleries.xml"><i class="bi bi-images" role="img">
</i> 
 <span class="dropdown-text">Gallery RSS feed</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Open Access Weather and Climate Data</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Importing qne using them in R</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Using R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pedro J. Aphalo </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2023-07-31</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">2023-08-01</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>Example R code to download, import and plot wheather and climate data for Europe and the whole Earth. The data bases used in the examples are E-Obs, TerraClimate and NASA Power.</p>
    </div>
  </div>

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>R packages, weather data</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-netcdf-format" id="toc-the-netcdf-format" class="nav-link" data-scroll-target="#the-netcdf-format">The NetCDF format</a></li>
  <li><a href="#gridded-data-and-interpolation" id="toc-gridded-data-and-interpolation" class="nav-link" data-scroll-target="#gridded-data-and-interpolation">Gridded data and interpolation</a></li>
  <li><a href="#data-use-restrictions-and-acknowledgements" id="toc-data-use-restrictions-and-acknowledgements" class="nav-link" data-scroll-target="#data-use-restrictions-and-acknowledgements">Data use restrictions and acknowledgements</a></li>
  <li>
<a href="#the-data-bases" id="toc-the-data-bases" class="nav-link" data-scroll-target="#the-data-bases">The data bases</a>
  <ul class="collapse">
<li><a href="#terraclimate" id="toc-terraclimate" class="nav-link" data-scroll-target="#terraclimate">TerraClimate</a></li>
  <li><a href="#e-obs" id="toc-e-obs" class="nav-link" data-scroll-target="#e-obs">E-OBS</a></li>
  <li><a href="#nasa-power" id="toc-nasa-power" class="nav-link" data-scroll-target="#nasa-power">NASA POWER</a></li>
  <li><a href="#erythemal-uv-radiation-and-ozone-column" id="toc-erythemal-uv-radiation-and-ozone-column" class="nav-link" data-scroll-target="#erythemal-uv-radiation-and-ozone-column">Erythemal UV radiation and ozone column</a></li>
  <li><a href="#other-data-sources" id="toc-other-data-sources" class="nav-link" data-scroll-target="#other-data-sources">Other data sources</a></li>
  </ul>
</li>
  <li><a href="#related-reading" id="toc-related-reading" class="nav-link" data-scroll-target="#related-reading">Related reading</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page is still a draft. Code examples do work but will be expanded and the text will be revised.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this page code chunks are “folded” so as to decrease the clutter when searching for examples. Above each plot you will find one or more “folded” code chuncks signalled by a small triangle followed by “Code”. Clicking on the triangle “unfolds” the code chunk making visible the R code used to produce the plot.</p>
<p>The code in the chunks can be copied by clicking on the top right corner, where an icon appears when the mouse cursor hovers over the code listing.</p>
<p>The <code>&lt;/&gt; Code</code> drop down menu to the right of the page title makes it possible to unfold all code chunks and to view the Quarto source of the whole web page.</p>
<p>Names of functions and other R objects are linked to the corresponding on-line help pages. The names of R extension packages are linked to their documentation web sites when available.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The content of this page was originally written for the <em>Hints and Tips</em> section of the <a href="https://bulletin.uv4plants.org/">UV4Plants Bulletin</a> but was not published as the Bulletin ceased to be published.</p>
</div>
</div>
<section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A problem faced when designing studies comparing plant responses over broad regions is how to obtain consistent and reliable weather and climatological data. Inspired by Danielle Griffoni’s presentation at the most recent UV4Plants network meeting and my own need for such data, I have chosen as the subject of the present column <em>Weather and climate: Open data sources</em>. By necessity the contents of this article deals with just a few examples out of the many data sources available, and is far from being comprehensive. The included code examples are in R, simply because R is the language I use most frequently. Frequent users Python and other computer languages would surely be able to produce similar code examples in their favourite language.</p>
<p>We are in the era of <em>Big Data</em> and <em>Open Data</em> but how can we find, download and use these data? As usual, I will use R for the examples. Most spatially and temporarily indexed data are nowadays stored in a file format called NetCDF4, or the fourth update of the NetCDF format’s definition. The key advantage of these files is that they can be read selectively. In other words, data can be read and used from files that are larger than the available computer memory. This is crucial because for daily data on a dense grid, such as those at 1/24<span class="math inline">\(^\circ\)</span> of latitude and longitude, with global or continental coverage and many decades of data, a single variable can require tens of giga bytes of storage. How much of the data included in these sets one will actually use depends on the number of sites and length of time of interest, and in many cases it is only a tiny portion of the whole data set.</p>
<p>Recently I was working with daily data for nearly <span class="math inline">\(1\,000\)</span> sites over more than 60 years, producing multiple rolling and accumulated summaries in R and I ended creating a data frame (<span class="math inline">\(\approx\)</span> a worksheet) containing nearly <span class="math inline">\(1\,000\,000\,000\)</span> values! The bright side is that I could do this processing both on my four-years-old slim laptop (ThinkPad T395s) and on a 12-years-old desktop PC (a Lenovo ThinkStation E30 from 2011). Of course, reading and processing the data are time-consuming. In this case my script took over 1/2 a day to run for each meteorological variable read and summarised.</p>
<p>Getting access to such a trove of curated and validated meteorological data opens the door to many data analyses, while on the other hand, as data on UV irradiance not weighted with the erythremal action spectrum is rather scarce, things are not as easy for UV research as one would like. Global radiation and ozone column are more easily obtainable, opening the door to radiation transfer modelling.</p>
</section><section id="the-netcdf-format" class="level2"><h2 class="anchored" data-anchor-id="the-netcdf-format">The NetCDF format</h2>
<p><em>Network Common Data Form</em> (NetCDF) files are described as self-descriptive, machine and computer-language independent, scalable, appendable, and shareable. What does this all mean in practice?</p>
<p>NetCDF files contain meta-data indicating the units of expression of the values stored and a short description for each variable. Some variables are tagged as describing the grid on which data are stored, for geographical data the grid is given by latitude and longitude. In the case of meteorological data, time adds a third dimension to the grid. For transcriptome data from a microarray the grid will describe the coordinates the ``cells’’ in the array.</p>
<p>A NetCDF file saved under one operating system (e.g., Linux, Windows, etc.) or computer architecture (e.g., Intel 8086, ARM, etc.) can be read and written to under any other. This works not only locally, but also remotely through the internet. Mulitple ``clients’’ can read the same file simultaneously, locally or remotely, and selectively.</p>
<p>NetCDF files can be huge (several gigabytes in size), but as they can be selectively read from and written to based on positions along grid dimensions, even remotely, they avoid unnecessary data transmission if read remotely, or the need for enough RAM capacity to read the whole file at once. As the files can be reopened to incrementally add data, once again, this can be done efficiently and frequently. Remote access allowing selective download is implemented using the <a href="https://www.unidata.ucar.edu/software/tds/">THREDDS</a> , <a href="https://www.opendap.org/">OPeNDAP</a> and similar DAP servers (DAP is an acronym for data access protocol). These servers can be accessed both interactively though a web browser or through software such as from R or Python scripts. When the file format is NetCDF some R packages make remote access consistent with local file access, which is an advantage.</p>
<p>The use of the NetCDF file format is widespread for meteorological and geophysical data, but also used in other fields. NetCDF files are well supported by software as the core software libraries needed are available for free and are open-source. The format was developed by <a href="https://www.unidata.ucar.edu/software/netcdf/">UniData</a> primarily for storing geophysical data.</p>
</section><section id="gridded-data-and-interpolation" class="level2"><h2 class="anchored" data-anchor-id="gridded-data-and-interpolation">Gridded data and interpolation</h2>
<p>Original data collected at ground level by weather stations are not available on a regular grid, but instead stations are irregularly distributed in space, and measurements describe conditions at these specific locations. Data derived from satellite instrumentation are distributed following the overpass tracks and represent spatial averages as dictated by the resolution of the cameras or other instruments. The merging of data from multiple sources, using models, receives the name of ``data assimilation’’.</p>
<p>Many of the currently available climatological data sets integrate data from multiple sources, and re-express them on a regular grid to facilitate their use. Spatial interpolation is used to achieve this, and obviously the uncertainty of the interpolated values as re-expressed on the grid depends on the density of observations available as well as their uncertainty. The interpolation process is also affected by topography, which even when explicitly taken into account, adds to the uncertainty of the data. In these data sets, the uncertainty varies among variables, as for example, more meteorological stations have instrumentation for air temperature than for global radiation. Depending on the data set, long term trends may be meaningful or not, as bias can be introduced by changes in the location of weather stations or more frequently by changes to their surroundings, say expansion of the built-up area of a city. Some data bases include data derived from the primary observations, such soil moisture or climatic water deficit. Obviously, when variables like potential evapotranspiration (PET) is derived from primary observations, uncertainties accumulate. As with any derived or interpolated data, it is important to understand their origin, uncertainties involved and the use they have been designed for. Data sets are prepared with an objective in mind and validated for a certain use. For example, in some cases interpolation has prioritized the minimization or temporal biases and in other cases it has not.</p>
<p>One final reminder: spatial grid density after interpolation does no longer reflect the spatial density of measurements. So if data are interpolated to a grid with 1/24 degree resolution using data from stations that are 100’s of kilometers away, what we gain by gridding is not new information but only an informed guess of what may have been the conditions at a location for which there is no data available. Sometimes, other information is used to improve the predictions, such as the elevation above sea level at each grid point. In any case, topography decreases the reliability of the gridded estimates in mountainous regions.</p>
</section><section id="data-use-restrictions-and-acknowledgements" class="level2"><h2 class="anchored" data-anchor-id="data-use-restrictions-and-acknowledgements">Data use restrictions and acknowledgements</h2>
<p>The data in each data base may have multiple origins and been subjected to various processing steps. There is much personal effort and money invested in them, and proper recognition is due to authors. In practice, continued availability of these data resources depends on demonstration of their usefulness and contribution to scientific progress and practical applications being demonstrated. This makes crucial that every user without exception correctly acknowledges the use of open data sources.</p>
<p>The use of the data in these databases is subject to restrictions, for example, E-OBS data cannot be used for commercial purposes, at least without obtaining explicit authorization. Each database has instructions about how the source should be acknowledged. Do check these before use and make sure to comply with acknowledgements as requested by the authors. These restrictions and specially how to cite the databases can change in time. For example when the data set is updated or when a new article is published describing the data or the method used. This means that in most cases we should use the most recent version of the data, and always check the current use restrictions and include the citation(s) and acknowledgement(s) as required or suggested at the time we are preparing the publication-ready version of our manuscripts.</p>
</section><section id="the-data-bases" class="level2"><h2 class="anchored" data-anchor-id="the-data-bases">The data bases</h2>
<p>I will show how to retrieve data from several databases containing data of interest for research with plants and vegetation. Most databases provide multiple ways to retrieve data, in most cases using the NetCDF file format described above. Interactive access with a browser is demonstrated for E-OBS in a video (Video S1), while here I demonstrate code-based data access, download as well as some post-precessing with examples using R.</p>
<section id="terraclimate" class="level3"><h3 class="anchored" data-anchor-id="terraclimate">TerraClimate</h3>
<p><a href="https://www.climatologylab.org/terraclimate.html">TerraClimate</a> provides monthly data with worldwide coverage at a very high resolution (1/24 degree), and in addition to monthly summaries for weather measurements it contains several derived variables very useful for ecological studies and agriculture (<a href="#tbl-terraclimate-vars" class="quarto-xref">Table&nbsp;1</a>). The data have been validated against different measurements, but it must be remembered that the availability of primary data is very uneven across the Earth surface, and uncertainties vary accordingly. The data are derived from the assimilation of multiple data sources, including both surface and remote measurements. It is important to be aware that although the data are provided on a very dense spatial grid, the original data are much more sparse, so the true spatial resolution is not as fine as one would think at first sight. On the other hand the interpolated values can in many cases be the best approximation available to the unknown conditions at a given point in space.</p>
<div id="tbl-terraclimate-vars" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-terraclimate-vars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Variables in the TerraClimate data set. Variables names used in the data set and brief text descriptions. The metadata included in the netCDF files provides up-to-date information on the units and basis of expressing and there encoding in the files.
</figcaption><div aria-describedby="tbl-terraclimate-vars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">aet</td>
<td style="text-align: left;">Actual Evapotranspiration, monthly total</td>
</tr>
<tr class="even">
<td style="text-align: left;">def</td>
<td style="text-align: left;">Climate Water Deficit, monthly total</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pet</td>
<td style="text-align: left;">Potential evapotranspiration, monthly total</td>
</tr>
<tr class="even">
<td style="text-align: left;">ppt</td>
<td style="text-align: left;">Precipitation, monthly total</td>
</tr>
<tr class="odd">
<td style="text-align: left;">q</td>
<td style="text-align: left;">Runoff, monthly total</td>
</tr>
<tr class="even">
<td style="text-align: left;">soil</td>
<td style="text-align: left;">Soil Moisture, total column at end of month</td>
</tr>
<tr class="odd">
<td style="text-align: left;">srad</td>
<td style="text-align: left;">Downward surface shortwave radiation</td>
</tr>
<tr class="even">
<td style="text-align: left;">swe</td>
<td style="text-align: left;">Snow water equivalent at end of month</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tmax</td>
<td style="text-align: left;">Max Temperature, average for month</td>
</tr>
<tr class="even">
<td style="text-align: left;">tmin</td>
<td style="text-align: left;">Min Temperature, average for month</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vpd</td>
<td style="text-align: left;">Vapor Pressure Deficit, average for month</td>
</tr>
<tr class="even">
<td style="text-align: left;">vap</td>
<td style="text-align: left;">Vapor pressure, average for month</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ws</td>
<td style="text-align: left;">Wind speed, average for month</td>
</tr>
<tr class="even">
<td style="text-align: left;">PDSI</td>
<td style="text-align: left;">Palmer Drought Severity Index, at end of month</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>TerraClimate also provides future climate projections developed for two different climate futures: when global mean temperatures are (1) 2,<span class="math inline">\(^{\circ}\)</span>C and (2) 4,<span class="math inline">\(^{\circ}\)</span>C warmer than pre-industrial, and (2) when global mean temperatures are 4,<span class="math inline">\(^{\circ}\)</span>C above preindustrial. The future climate data are based on actual data from years 1985–2015, which for the manipulated data are called pseudo-years. The values of variables for future climate are based on multiple simulation models.</p>
<p>This data base supports the OPeNDAP protocol which allows selective download from a remotely served NetCDF file, in addition to allowing download of the whole data set and ready-made subsets. The data set has 37.3 million grid points for 14 variables for each of 12 months for 61 years, i.e., <span class="math inline">\(\approx
382\times10^9\)</span> data values plus the values describing each of the coordinates for each grid point. This is Big Data.</p>
<p>Once one understands how to remotely read a NetCDF file, and how to select the observations from the 3D grid (latitude, longitude and time), the R code needed is rather simple. In this case we need to download variables one by one. The information we need to know is the URL to use. In this database the URLs differ only by the name of the variable.</p>
<p>Package ‘tidync’ can be used to retrieve the data in one step directly getting a <code>tibble</code>. There is a difficulty when retrieving data: we need to know the coordinates for the grid points that are nearest to our target locations. In this example we will retrieve data for a single grid point and time.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tidync/">tidync</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var</span><span class="op">=</span><span class="st">"tmax"</span></span>
<span></span>
<span><span class="va">data_url</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_"</span>,</span>
<span>                <span class="va">var</span><span class="op">)</span>,</span>
<span>         <span class="st">"_1958_CurrentYear_GLOBE.nc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html">tidync</a></span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tnc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Data Source (1): agg_terraclimate_tmax_1958_CurrentYear_GLOBE.nc ...

Grids (5) &lt;dimension family&gt; : &lt;associated variables&gt; 

[1]   D2,D1,D3 : tmax    **ACTIVE GRID** ( 29113344000  values per variable)
[2]   D0       : crs
[3]   D1       : lat
[4]   D2       : lon
[5]   D3       : time

Dimensions 4 (3 active): 
  
  dim   name  length     min     max start count    dmin    dmax unlim coord_dim 
  &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     
1 D1    lat     4320   -90.0    90.0     1  4320   -90.0    90.0 FALSE TRUE      
2 D2    lon     8640  -180.    180.      1  8640  -180.    180.  FALSE TRUE      
3 D3    time     780 21184   44894       1   780 21184   44894   FALSE TRUE      
  
Inactive dimensions:
  
  dim   name  length   min   max unlim coord_dim 
  &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     
1 D0    crs        1     3     3 FALSE TRUE      </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># a single grid point</span></span>
<span><span class="va">my.lon</span> <span class="op">&lt;-</span> <span class="fl">45.05</span></span>
<span><span class="va">my.lat</span> <span class="op">&lt;-</span> <span class="fl">45.01</span></span>
<span><span class="co"># we need to take into account how values in variable time are stored</span></span>
<span><span class="va">my.month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2015-06-01"</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1900-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we use tests as arguments for lon and lat to find the nearest grid point</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html">hyper_tibble</a></span><span class="op">(</span><span class="va">tnc</span>,</span>
<span>             lon <span class="op">=</span> <span class="va">index</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">lon</span> <span class="op">-</span> <span class="va">my.lon</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             lat <span class="op">=</span> <span class="va">index</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">lat</span> <span class="op">-</span> <span class="va">my.lat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             time <span class="op">=</span> <span class="va">time</span> <span class="op">==</span> <span class="va">my.month</span>,</span>
<span>             na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># convert time in number of days to a date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1900-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tmax</span><span class="op">)</span> <span class="op">==</span> <span class="fl">32768</span>, <span class="cn">NA</span>, <span class="va">tmax</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">time</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">grid_point.tb</span></span>
<span></span>
<span><span class="co"># print the result</span></span>
<span><span class="va">grid_point.tb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
   tmax   lon   lat date        year month
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
1  31.8  45.1  45.0 2015-06-01  2015     6</code></pre>
</div>
</div>
<p>We continue from the previous example retrieving data from all grid points within an area and for a time period. To save typing we define a function, which, thanks to its name, makes also clear the intention of the code.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">is_within</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">range</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># protect from ranges given backwards</span></span>
<span>  <span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">range</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># we save the limits to variables</span></span>
<span><span class="va">my.lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50.5</span><span class="op">)</span></span>
<span><span class="va">my.lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30.5</span>, <span class="fl">31</span><span class="op">)</span></span>
<span><span class="va">my.period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1960-03-01"</span>, <span class="st">"1960-09-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1900-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html">hyper_tibble</a></span><span class="op">(</span><span class="va">tnc</span>,</span>
<span>             lon <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">lon</span>, <span class="va">my.lon</span><span class="op">)</span>,</span>
<span>             lat <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">lat</span>, <span class="va">my.lat</span><span class="op">)</span>,</span>
<span>             time <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">time</span>, <span class="va">my.period</span><span class="op">)</span>,</span>
<span>             na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># convert time in number of days to a date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1900-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tmax</span><span class="op">)</span> <span class="op">==</span> <span class="fl">32768</span>, <span class="cn">NA</span>, <span class="va">tmax</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">time</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">grid_area_in_time.tb</span></span>
<span></span>
<span><span class="va">grid_area_in_time.tb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 720 × 6
    tmax   lon   lat date        year month
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  27.8  50.0  31.0 1960-04-01  1960     4
 2  27.5  50.1  31.0 1960-04-01  1960     4
 3  26.6  50.1  31.0 1960-04-01  1960     4
 4  23.2  50.1  31.0 1960-04-01  1960     4
 5  23.8  50.2  31.0 1960-04-01  1960     4
 6  26.0  50.2  31.0 1960-04-01  1960     4
 7  26.8  50.3  31.0 1960-04-01  1960     4
 8  26.7  50.3  31.0 1960-04-01  1960     4
 9  26.6  50.4  31.0 1960-04-01  1960     4
10  26.6  50.4  31.0 1960-04-01  1960     4
# ℹ 710 more rows</code></pre>
</div>
</div>
<p>In principle we could download the whole files, and access them locally, but the catch is in the size of the files: up to a few GB per variable. For this reason, unless we plan to use a large chunk of the data, or repeatedly extract different subsets it is more efficient to use selective downloads.</p>
</section><section id="e-obs" class="level3"><h3 class="anchored" data-anchor-id="e-obs">E-OBS</h3>
<p>The <a href="https://surfobs.climate.copernicus.eu">E-OBS</a> <span class="citation" data-cites="Cornes2018">(<a href="#ref-Cornes2018" role="doc-biblioref">Cornes et al. 2018</a>)</span> covers Europe plus nearby regions including land bordering the Mediterranean sea to the South and East. Data is daily and based on measurements at thousands of weather stations and extends at the time of writing from 1920-01-01 to 2023-07-30. These data have estimates of uncertainty for each variable, grid and time point. The maximum spatial resolution available is 1/10 degree for both latitude and longitude. Download of data is free but requires registration. Data is restricted to non-commercial use. In this case, after logging-in into the web site one can download the NetCDF files to a local disk (Video: XXXXX). Once downloaded, as a second step, one can access the file as shown above for TerraClimate data. The most reliable data are from 1950 to the present, and at 1/10 degree resolution. Files contain data for a single variable, and are large (6 to 15 GB each). Estimates of uncertainty are also in individual files, one per variable.</p>
<p>We can adjust the code shown above to work with these files. First step is to use a file path instead of an URL. When exploring the properties of the file we can notice some differences, even in the names of the grid variables and how time is encoded (the starting date is different).</p>
<p>OPeNDAP access is available at (http://opendap.knmi.nl/knmi/thredds/dodsC/) through a THREDDS server maintained by the Royal Netherlands Meteorological Institute, but the version currently available is two years behind the Copernicus server of EU. With <code>catalog.html</code> listing the data sets and for example the link ending in <code>e-obs_0.25regular/tg_0.25deg_reg_v17.0.nc</code> giving access to the variable <code>tg</code> with daily mean air temperature.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We will use local file downloaded from web page</span></span>
<span><span class="co"># This file is nearly 800 MB in size but online query is cumbersome for this</span></span>
<span><span class="co"># server.</span></span>
<span></span>
<span><span class="va">eobs_tnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html">tidync</a></span><span class="op">(</span><span class="st">"data/tg_ens_mean_0.25deg_reg_v27.0e.nc"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">eobs_tnc</span>, <span class="st">"tg"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Data Source (1): tg_ens_mean_0.25deg_reg_v27.0e.nc ...

Grids (4) &lt;dimension family&gt; : &lt;associated variables&gt; 

[1]   D1,D2,D0 : tg    **ACTIVE GRID** ( 2486698032  values per variable)
[2]   D0       : time
[3]   D1       : longitude
[4]   D2       : latitude

Dimensions 3 (all active): 
  
  dim   name      length   min     max start count  dmin    dmax unlim coord_dim 
  &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     
1 D0    time       26663   0   26662       1 26663   0   26662   TRUE  TRUE      
2 D1    longitude    464 -40.4    75.4     1   464 -40.4    75.4 FALSE TRUE      
3 D2    latitude     201  25.4    75.4     1   201  25.4    75.4 FALSE TRUE      </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">eobs_tnc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Data Source (1): tg_ens_mean_0.25deg_reg_v27.0e.nc ...

Grids (4) &lt;dimension family&gt; : &lt;associated variables&gt; 

[1]   D1,D2,D0 : tg    **ACTIVE GRID** ( 2486698032  values per variable)
[2]   D0       : time
[3]   D1       : longitude
[4]   D2       : latitude

Dimensions 3 (all active): 
  
  dim   name      length   min     max start count  dmin    dmax unlim coord_dim 
  &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     
1 D0    time       26663   0   26662       1 26663   0   26662   TRUE  TRUE      
2 D1    longitude    464 -40.4    75.4     1   464 -40.4    75.4 FALSE TRUE      
3 D2    latitude     201  25.4    75.4     1   201  25.4    75.4 FALSE TRUE      </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># we save the limits to variables</span></span>
<span><span class="va">my.lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">my.lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">65</span><span class="op">)</span></span>
<span><span class="va">my.period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-03-01"</span>, <span class="st">"2021-09-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1950-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html">hyper_tibble</a></span><span class="op">(</span><span class="va">eobs_tnc</span>,</span>
<span>             longitude <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">longitude</span>, <span class="va">my.lon</span><span class="op">)</span>,</span>
<span>             latitude <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">latitude</span>, <span class="va">my.lat</span><span class="op">)</span>,</span>
<span>             time <span class="op">=</span> <span class="fu">is_within</span><span class="op">(</span><span class="va">time</span>, <span class="va">my.period</span><span class="op">)</span>,</span>
<span>             na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># convert time in number of days to a date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1950-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">time</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">grid_area_in_time.tb</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">grid_area_in_time.tb</span><span class="op">$</span><span class="va">tg</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 43082</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">grid_area_in_time.tb</span><span class="op">$</span><span class="va">tg</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1710518</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">grid_area_in_time.tb</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 43,082 × 6
       tg longitude latitude date        year month
    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  0.760     -15.1     64.4 2020-03-02  2020     3
 2  1.38      -14.9     64.4 2020-03-02  2020     3
 3 -0.620     -14.9     64.6 2020-03-02  2020     3
 4  0.870     -14.6     64.6 2020-03-02  2020     3
 5  1.18      -14.4     64.6 2020-03-02  2020     3
 6  0.230     -14.4     64.9 2020-03-02  2020     3
 7  0.920     -14.1     64.9 2020-03-02  2020     3
 8  1.25      -13.9     64.9 2020-03-02  2020     3
 9  0.220     -15.1     64.4 2020-03-03  2020     3
10  0.800     -14.9     64.4 2020-03-03  2020     3
# ℹ 43,072 more rows</code></pre>
</div>
</div>
<p>From here onwards we can continue as shown above for TerraClimate, but replacing the starting date for time of <code>ymd("1900-01-01")</code> by <code>ymd("1950-01-01")</code> and the missing value marker <code>32768</code> by <code>9999</code>. These values are taken from the metadata we printed with the code above.</p>
</section><section id="nasa-power" class="level3"><h3 class="anchored" data-anchor-id="nasa-power">NASA POWER</h3>
<p><a href="https://power.larc.nasa.gov">NASA POWER</a> hosts data mainly intended for renewable energy estimates such as temperature, relative humidity, precipitation, solar radiation, clouds, wind speed and wind direction, all in all data for 161 parameters. The maximum spatial resolution available is 1/10 degree for both latitude and longitude. Geographic coverage is global, hourly values are available in near-real-time. Gridded values are based on remote data acquired with satellite instruments. The available solar and weather data can be useful for other purposes in addition to renewable energy assessments. These data can be accessed using R package ‘nasapower’ built on top of the online API. In this case, the data set specific package works differently, returning a tibble, without exposing NetCDF files to the user.</p>
<p>In the case of NASA POWER any valid longitude and altitude can be passed, so we do not need to define R code to search for the nearest available grid point as we did above. In addition, the value passed to <code>community</code> parameter affects the units in which the values are returned. By passing <code>"AG"</code>, for agro-climatology, we obtain the radiation in MJ/m-2/d-1. Metadata is also retrieved and stored in the object containing the data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nasapower/">nasapower</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># long printout, use to se what is available</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># query_parameters(community = "ag",</span></span>
<span><span class="co">#                  temporal_api = "hourly")</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/nasapower/reference/query_parameters.html">query_parameters</a></span><span class="op">(</span>par <span class="op">=</span> <span class="st">"T2M"</span>,</span>
<span>                 community <span class="op">=</span> <span class="st">"ag"</span>,</span>
<span>                 temporal_api <span class="op">=</span> <span class="st">"hourly"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$T2M
$T2M$type
[1] "METEOROLOGY"

$T2M$temporal
[1] "HOURLY"

$T2M$source
[1] "MERRA2"

$T2M$community
[1] "AG"

$T2M$calculated
[1] FALSE

$T2M$inputs
NULL

$T2M$units
[1] "C"

$T2M$name
[1] "Temperature at 2 Meters"

$T2M$definition
[1] "The average air (dry bulb) temperature at 2 meters above the surface of the earth."</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># we download the data for one grid point, Joensuu, Finland</span></span>
<span><span class="va">daily_single_ag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/nasapower/reference/get_power.html">get_power</a></span><span class="op">(</span></span>
<span>  community <span class="op">=</span> <span class="st">"AG"</span>,</span>
<span>  lonlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">29.76</span>, <span class="fl">62.60</span><span class="op">)</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RH2M"</span>, <span class="st">"T2M"</span>, <span class="st">"ALLSKY_SFC_SW_DWN"</span><span class="op">)</span>,</span>
<span>  dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-06-01"</span>, <span class="st">"2020-06-30"</span><span class="op">)</span>,</span>
<span>  temporal_average <span class="op">=</span> <span class="st">"DAILY"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: `temporal_average has been deprecated for `temporal_api`.
Your query has been modified to use the new terminology for `get_power`.  Please update your scripts to use the new argument.</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># print the downloaded data</span></span>
<span><span class="va">daily_single_ag</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>NASA/POWER CERES/MERRA2 Native Resolution Daily Data  
 Dates (month/day/year): 06/01/2020 through 06/30/2020  
 Location: Latitude  62.6   Longitude 29.76  
 Elevation from MERRA-2: Average for 0.5 x 0.625 degree lat/lon region = 111.91 meters 
 The value for missing source data that cannot be computed or is outside of the sources availability range: NA  
 Parameter(s):  
 
 Parameters: 
 RH2M                  MERRA-2 Relative Humidity at 2 Meters (%) ;
 T2M                   MERRA-2 Temperature at 2 Meters (C) ;
 ALLSKY_SFC_SW_DWN     CERES SYN1deg All Sky Surface Shortwave Downward Irradiance (MJ/m^2/day)  
 
# A tibble: 30 × 10
     LON   LAT  YEAR    MM    DD   DOY YYYYMMDD    RH2M   T2M ALLSKY_SFC_SW_DWN
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;
 1  29.8  62.6  2020     6     1   153 2020-06-01  76.8  9.94             18.8 
 2  29.8  62.6  2020     6     2   154 2020-06-02  67.7 12.3              26.2 
 3  29.8  62.6  2020     6     3   155 2020-06-03  70.2 13.0              26.4 
 4  29.8  62.6  2020     6     4   156 2020-06-04  81.7 13.0              19.1 
 5  29.8  62.6  2020     6     5   157 2020-06-05  85.2 14                 9.83
 6  29.8  62.6  2020     6     6   158 2020-06-06  85.2 14.9              15.4 
 7  29.8  62.6  2020     6     7   159 2020-06-07  72.6 14.4              24.3 
 8  29.8  62.6  2020     6     8   160 2020-06-08  89.8 17.2              14.1 
 9  29.8  62.6  2020     6     9   161 2020-06-09  84.9 17.6              12.5 
10  29.8  62.6  2020     6    10   162 2020-06-10  85.8 16                22.1 
# ℹ 20 more rows</code></pre>
</div>
</div>
<p>We must be aware that near-real-time data from remote sensing is not subjected to as thorough a quality control as validated data made available with a longer delay.</p>
</section><section id="erythemal-uv-radiation-and-ozone-column" class="level3"><h3 class="anchored" data-anchor-id="erythemal-uv-radiation-and-ozone-column">Erythemal UV radiation and ozone column</h3>
<p>We will import data from a file downloaded manually (using URL https://avdc.gsfc.nasa.gov/index.php?site=164609600&amp;id=79) and corresponding to Ushuaia, Argentina. When we first download data from a server as a text file, we need to inspect it. Most files will have a header with metadata and which needs to be read separately from the data itself. In this case, opening the file in a text editor, such as RStudio, notepad or nano, we can see that lines from 51 onwards contain the data in tabular shape and that line 51 contains the variable (= column) names. From this we know that we need to separately read the first 50 lines as a header, and that for reading the data themselves we need to skip 50 lines at the top of the file. We save to the header in the ‘comment’ attribute of the data frame.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dirk.eddelbuettel.com/code/anytime.html">anytime</a></span><span class="op">)</span></span>
<span><span class="va">my.file</span> <span class="op">&lt;-</span> <span class="st">"data/aura_omi_l2ovp_omuvb_v03_ushuaia.txt"</span></span>
<span><span class="va">header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">my.file</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">omiuvb.tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html">read_table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my.file</span>,</span>
<span>                        skip <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                         Datetime <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                         DOY <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                         Orbit <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/comment.html">comment</a></span><span class="op">(</span><span class="va">omiuvb.tb</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">header</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will most likely be interested in a few of the columns rather than in all of them. We can inspect the header of the file itself, or the documentation of the data set to identify the columns containing the data we need, and then select these columns and study the description of these fields, and as shown below.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># cat(grkmisc::pretty_string(comment(omiuvb.tb), wrap_at = 70, truncate_at = Inf), sep =  "\n")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">omiuvb.tb</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] "Datetime"   "MJD2000"    "Year"       "DOY"        "sec.(UT)"  
 [6] "Orbit"      "CTP"        "Lat."       "Lon."       "Dis"       
[11] "SZA"        "VZA"        "GPQF"       "OMAF"       "OMQF"      
[16] "UVBQF"      "OMTO3_O3"   "CSEDDose"   "CSEDRate"   "CSIrd305"  
[21] "CSIrd310"   "CSIrd324"   "CSIrd380"   "CldOpt"     "EDDose"    
[26] "EDRate"     "Ird305"     "Ird310"     "Ird324"     "Ird380"    
[31] "OPEDRate"   "OPIrd305"   "OPIrd310"   "OPIrd324"   "OPIrd380"  
[36] "CSUVindex"  "OPUVindex"  "UVindex"    "LambEquRef" "SufAlbedo" 
[41] "TerrHgt"   </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">column_selector</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"DOY"</span>, <span class="st">"OMTO3_O3"</span>, <span class="st">"EDDose"</span>, <span class="st">"UVBQF"</span>, <span class="st">"OMQF"</span><span class="op">)</span></span>
<span><span class="va">pattern</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">column_selector</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span><span class="va">header</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">header</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Year      : Year"                                        
[2] "DOY       : Day Of Year"                                 
[3] "OMQF      : OMTO3 Quality Flags (dimensionless)"         
[4] "UVBQF     : Quality Flags on Pixel Level (dimensionless)"
[5] "OMTO3_O3  : Total column ozone (DU)"                     
[6] "CSEDDose  : Clear Sky Erythemal Daily Dose (J/m^2)"      
[7] "EDDose    : Erythemal Daily Dose (J/m^2)"                </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">omiuvb.tb</span><span class="op">[</span> , <span class="va">column_selector</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,508 × 6
    Year   DOY OMTO3_O3 EDDose UVBQF  OMQF
   &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2004   275     282.   447. 20480     0
 2  2004   275     295.   875. 20482 32768
 3  2004   276     317.  1846. 20480     0
 4  2004   276     317.  1438. 20480     0
 5  2004   277     323.  1552. 20482 36864
 6  2004   277     321.  1340. 20480     0
 7  2004   278     320.  1631. 20480     0
 8  2004   278     320.  1650. 20480     0
 9  2004   279     297.  1385. 20480     0
10  2004   279     288.  1433. 20482 36864
# ℹ 9,498 more rows</code></pre>
</div>
</div>
<p>These data originate from satellite observations and are based on cloudiness and aerosols as observed during overpass. Ozone column values are more reliable than erythemal UV doses, as ozone column thickness varies very little between overpasses while cloudiness can vary much more. EDDose can be up to 30% overestimated. It is important to read the data product documentation before using the data and to understand the meaning of the quality flags, as some observations may need to be discarded. Estimates are specially unreliable when there is a snow or ice cover on the ground as it affects estimates of cloudiness.</p>
</section><section id="other-data-sources" class="level3"><h3 class="anchored" data-anchor-id="other-data-sources">Other data sources</h3>
<p>The <a href="https://www.ecmwf.int/">European Centre for Medium-Range Weather Forecasts</a> is another source of useful data. For example the “ECMWF Reanalysis v5” or ERA5 is a reanalysis of world-wide weather going back all the way to 1950. These data rely more strongly on modelling but the highest temporal resolution available is hourly. The file format used is not NetCDF but, instead, GRIB.</p>
<p>The <a href="https://www.noaa.gov/">National Oceanic and Atmospheric Administration</a> (NOAA) in the USA, has for many years provided open access to data. Both data sets with national and world-wide coverage are hosted. The R package ‘rNOMADS’ facilitates access to these data.</p>
<p>Various national weather services also make at least some data available on-line as part of the recent emphasis on “open government”. For example, for Spain precipitation data with less uncertainty than that in E-OBS is available. In the case of Finland, historical data from meteorological stations is one of the data sets available on-line through an API interface giving access to several variables from <a href="https://en.ilmatieteenlaitos.fi/open-data-sets-available">FMI</a>. In this case there is a well documented R package which has not yet been published in CRAN but that can be installed from a git repository hosted at <a href="https://github.com/rOpenGov/fmi2">GitHub</a>.</p>
<p>NASA maintains a metadata catalogue for <a href="https://earthdata.nasa.gov/">Earth Observation Data</a>. At this site there is a link <a href="https://www.earthdata.nasa.gov/learn/find-data">“Find Data”</a> allowing searches. Searching the catalogue can be overwhelming unless one starts by limiting the scope of data sources where to search, say by type of instrument, or some other broad criterion.</p>
<p>The <a href="https://idn.ceos.org/">CEOS International Directory Network (IDN)</a> can be also of help. For example, searching for “ozone layer” and then selecting “OMI” as instrument provides a list of useful data sets of manageable length.</p>
<p><a href="https://worldview.earthdata.nasa.gov/">NASA’s World View</a> makes it possible to interactively explore data sets graphically as “layers” on a world map, but also provides links to download the same data as numerical values. Some data are also available through the <a href="https://explorer.earthengine.google.com/">Google Earth Engine</a> after creating a user account.</p>
<p>The <a href="https://data.un.org/">UNdata site</a> gives access to world-wide and country statistics including the data from the <a href="https://public.wmo.int/en">World Meteorological Organization</a>.</p>
<p>Although off-topic, it is worthwhile mentioning that other types of data useful in our research are also becoming available on-line. These data sets include several related to species distributions, phenology and other data relevant to ecological research. In many cases, specific R packages are available for retrieval and import of the data. For R users it is worthwhile keeping a close eye on the <a href="https://ropensci.org/">ROpenScience web site</a> and on their <a href="https://ropensci.org/packages/data-access/">catalogue of peer-reviewed R packages</a>.</p>
<p>Few researchers in our field, including myself, extract all the information contained in the data they collect. Fewer, extract all the information obtainable by combining the data they collect with data about the context in which they do research. Even fewer quantitatively combine data over long periods or time, across research groups, institutions, countries, and continents, etc. In contrast, meteorologists do it all the time: they extract information, about very slow rates of change with background variation that is comparatively huge. How do they achieve this? Extreme care about methods: calibrations, cross-calibrations, and all sorts validations, cross validations and inter-comparisons. What does this mean in practice? With careful computations and further validation they can produce long time series of data covering most of our planet, based on measurements done by many thousands, possibly even millions, of different observers, sometimes using different methods, over hundreds of years! This is the source of the data we have now in our hands, for free. And how valuable this is!</p>
<p>I see this as the most cogent demonstration of what can be achieved when most researchers or <code>data collectors'' in a field aim consistently over a long time at what we now call</code>reproducible research’‘. In biology, we can seldom even get compatible results from a repeat of a single experiment. The complexity of biological systems is no excuse for this, as long as we do not even try to have enough replicates, document methods in enough detail and spend enough time and effort validating and calibrating methods against each other. I think, it is good time for biological research to catchup and follow the meteorologists’ example. To achieve this, we need to get researchers in our field to think about the long term value of the data we produce and how to enhance it. This is made difficult, when the evaluation of our productivity is so often based on the most recent 5 years and on the newsworthiness of individual papers rather than on long-term impact and reliability of experimental design and methods.</p>
<p>The has encouraged open sharing of data and consistency of methods since its creation as the <em>International Meteorological Organization</em> in 1873. In my opinion, this demonstrates that open availability of original data, allowing comparison and cross-checking can be a strong incentive for adoption of reproducible research approaches. As demonstrated by meteorological observations, the value added by generating data and its metadata in ways that allows the build up of large sets of data by combining a multitude of individual sources can be enormous. Just, how could we have dealt or even detected global climate change lacking consistently collected data from well before we realized that climate is changing?</p>
<p>Considering the shorter time frame of the current pandemic, that useful data are becoming so easily available opens an opportunity for keeping us busy. We can extract new information from these freely available data sets and also by combining them with the data we have earlier collected ourselves. So even if we are confined at home because of the COVID epidemic we can do original research!</p>
</section></section><section id="related-reading" class="level2"><h2 class="anchored" data-anchor-id="related-reading">Related reading</h2>
<p>A paper just published discusses satellite-retrieved UV-A data and its importance for biological research <span class="citation" data-cites="Parisi2021">(<a href="#ref-Parisi2021" role="doc-biblioref">Parisi et al. 2021</a>)</span>. Another paper, available only as a preprint, describes real-time UV-Index retrieval at high spatial and temporal resolution over the whole of Europe <span class="citation" data-cites="Kosmopoulos2021">(<a href="#ref-Kosmopoulos2021" role="doc-biblioref">Kosmopoulos et al. 2021</a>)</span>. An earlier paper is also of interest as it discusses some of the sources of bias in UV-irradiance retrieved from satellites <span class="citation" data-cites="Arola2009">(<a href="#ref-Arola2009" role="doc-biblioref">Arola et al. 2009</a>)</span>. Finally an agronomic paper of interest in relation to how biases in weather data retrieved from satellite observations can affect estimates of biological responses <span class="citation" data-cites="Bai2010">(<a href="#ref-Bai2010" role="doc-biblioref">Bai et al. 2010</a>)</span>.</p>
<p>Chapter 8 in my book <em>Learn R: As a Language</em><span class="citation" data-cites="Aphalo2020a">(<a href="#ref-Aphalo2020a" role="doc-biblioref">Aphalo 2020</a>)</span> provides code examples and explanations for importing data from files using additional formats to those I have discussed here.</p>
</section><section id="acknowledgements" class="level2"><h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>I warmly thank the discussions and thoughtful comments from Titta Kotilainen that helped me write and revise this column. I also thank Anders Lindfors for introducing me to the use of some of these sources of information and Heikki Hänninen for sharing a manuscript from his research group, a manuscript that woke up my curiosity about open data even more. This last step made the “energy level” surpass my activation threshold and got me playing with these databases, updating an old computer and downloading many gigabytes of climate, weather, phenological and other data. What started as tinkering several weeks ago, ended providing useful context data for three manuscripts that I am working on at the moment, an ideas for a couple of future articles! Not bad at all, and so an experience worthwhile sharing with our readers.</p>
</section><section id="references" class="level2"><h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Aphalo2020a" class="csl-entry" role="listitem">
Aphalo, Pedro J. 2020. <em><span class="nocase">Learn R: As a Language</span></em>. <span>The R Series</span>. CRC/Taylor &amp; Francis Ltd. <a href="https://www.learnr-book.info/">https://www.learnr-book.info/</a>.
</div>
<div id="ref-Arola2009" class="csl-entry" role="listitem">
Arola, A., S. Kazadzis, A. Lindfors, N. Krotkov, J. Kujanpää, J. Tamminen, A. Bais, et al. 2009. <span>“A New Approach to Correct for Absorbing Aerosols in <span>OMI</span> <span>UV</span>.”</span> <em>Geophysical Research Letters</em> 36 (22). <a href="https://doi.org/10.1029/2009gl041137">https://doi.org/10.1029/2009gl041137</a>.
</div>
<div id="ref-Bai2010" class="csl-entry" role="listitem">
Bai, Jinshun, Xinping Chen, Achim Dobermann, Haishun Yang, Kenneth G. Cassman, and Fusuo Zhang. 2010. <span>“Evaluation of <span>NASA</span> Satellite- and Model-Derived Weather Data for Simulation of Maize Yield Potential in China.”</span> <em>Agronomy Journal</em> 102 (1): 9–16. <a href="https://doi.org/10.2134/agronj2009.0085">https://doi.org/10.2134/agronj2009.0085</a>.
</div>
<div id="ref-Cornes2018" class="csl-entry" role="listitem">
Cornes, Richard C., Gerard van der Schrier, Else J. M. van den Besselaar, and Philip D. Jones. 2018. <span>“An Ensemble Version of the e-<span>OBS</span> Temperature and Precipitation Data Sets.”</span> <em>Journal of Geophysical Research: Atmospheres</em> 123 (17): 9391–9409. <a href="https://doi.org/10.1029/2017jd028200">https://doi.org/10.1029/2017jd028200</a>.
</div>
<div id="ref-Kosmopoulos2021" class="csl-entry" role="listitem">
Kosmopoulos, P. G., S. Kazadzis, A. W. Schmalwieser, P. I. Raptis, K. Papachristopoulou, I. Fountoulakis, A. Masoom, et al. 2021. <span>“Real-Time UV-Index Retrieval in Europe Using Earth Observation Based Techniques and Validation Against Ground-Based Measurements.”</span> <em>Atmospheric Measurement Techniques Discussions</em> 2021: 1–65. <a href="https://doi.org/10.5194/amt-2020-506">https://doi.org/10.5194/amt-2020-506</a>.
</div>
<div id="ref-Parisi2021" class="csl-entry" role="listitem">
Parisi, Alfio V., Damien Igoe, Nathan J. Downs, Joanna Turner, Abdurazaq Amar, and Mustapha A. A Jebar. 2021. <span>“Satellite Monitoring of Environmental Solar Ultraviolet a (<span>UVA</span>) Exposure and Irradiance: A Review of <span>OMI</span> and <span>GOME</span>-2.”</span> <em>Remote Sensing</em> 13 (4): 752. <a href="https://doi.org/10.3390/rs13040752">https://doi.org/10.3390/rs13040752</a>.
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Open Access Weather and Climate Data"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Importing qne using them in R"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Pedro J. Aphalo"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-07-31"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "2023-08-01"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Using R]</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span><span class="co"> [R packages, weather data]</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> hints.bib</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">  Example R code to download, import and plot wheather and climate data for Europe and the whole Earth. The data bases used in the examples are E-Obs, TerraClimate and NASA Power.</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>This page is still a draft. Code examples do work but will be expanded and the</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>text will be revised.</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>In this page code chunks are "folded" so as to decrease the clutter when</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>searching for examples. Above each plot you will find one or more "folded" code</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>chuncks signalled by a small triangle followed by "Code". Clicking on the</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>triangle "unfolds" the code chunk making visible the R code used to produce the</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>plot.</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>The code in the chunks can be copied by clicking on the top right</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>corner, where an icon appears when the mouse cursor hovers over the code</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>listing.</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>The <span class="in">`&lt;/&gt; Code`</span> drop down menu to the right of the page title makes it possible to unfold all code chunks and to view the Quarto source of the whole web page.</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>Names of functions and other R objects are linked to the corresponding on-line help pages. The names of R extension packages are linked to their documentation web sites when available.</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>The content of this page was originally written for the _Hints and Tips_ section of the <span class="co">[</span><span class="ot">UV4Plants Bulletin</span><span class="co">](https://bulletin.uv4plants.org/)</span> but was not published as the Bulletin ceased to be published.</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>A problem faced when designing studies comparing plant responses over broad</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>regions is how to obtain consistent and reliable weather and climatological</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>data. Inspired by Danielle Griffoni's presentation at the most recent</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>UV4Plants network meeting and my own need for such data, I</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>have chosen as the subject of the present column _Weather and</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>climate: Open data sources_. By necessity the contents of this article deals</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>with just a few examples out of the many data sources available, and is far</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>from being comprehensive. The included code examples are in R, simply because</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>R is the language I use most frequently. Frequent users Python and other</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>computer languages would surely be able to produce similar code examples in</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>their favourite language.</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>We are in the era of _Big Data_ and _Open Data_ but how can we</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>find, download and use these data? As usual, I will use R for the examples.</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>Most spatially and temporarily indexed data are nowadays stored in a file</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>format called NetCDF4, or the fourth update of the NetCDF format's</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>definition. The key advantage of these files is that they can be read</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>selectively. In other words, data can be read and used from files that are</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>larger than the available computer memory. This is crucial because for daily</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>data on a dense grid, such as those at 1/24$^\circ$ of latitude and</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>longitude, with global or continental coverage and many decades of data, a</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>single variable can require tens of giga bytes of storage. How much of the</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>data included in these sets one will actually use depends on the number of</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>sites and length of time of interest, and in many cases it is only a tiny</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>portion of the whole data set.</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>Recently I was working with daily data for nearly $1\,000$ sites over more than</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>60 years, producing multiple rolling and accumulated summaries in R and I ended</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>creating a data frame ($\approx$ a worksheet) containing nearly</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>$1\,000\,000\,000$ values! The bright side is that I could do this processing</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>both on my four-years-old slim laptop (ThinkPad T395s) and on a 12-years-old</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>desktop PC (a Lenovo ThinkStation E30 from 2011). Of course, reading and</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>processing the data are time-consuming. In this case my script took over 1/2 a</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>day to run for each meteorological variable read and summarised.</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>Getting access to such a trove of curated and validated meteorological data</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>opens the door to many data analyses, while on the other hand, as data on UV</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>irradiance not weighted with the erythremal action spectrum is rather scarce,</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>things are not as easy for UV research as one would like. Global radiation</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>and ozone column are more easily obtainable, opening the door to radiation</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>transfer modelling.</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## The NetCDF format</span></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>_Network Common Data Form_ (NetCDF) files are described as</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>self-descriptive, machine and computer-language independent, scalable,</span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>appendable, and shareable. What does this all mean in practice?</span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>NetCDF files contain meta-data indicating the units of expression of the</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>values stored and a short description for each variable. Some variables are</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>tagged as describing the grid on which data are stored, for geographical data</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>the grid is given by latitude and longitude. In the case of meteorological</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>data, time adds a third dimension to the grid. For transcriptome data from a</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>microarray the grid will describe the coordinates the ``cells'' in the array.</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>A NetCDF file saved under one operating system (e.g., Linux, Windows, etc.)</span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>or computer architecture (e.g., Intel 8086, ARM, etc.) can be read and</span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>written to under any other. This works not only locally, but also remotely</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>through the internet. Mulitple ``clients'' can read the same file</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>simultaneously, locally or remotely, and selectively.</span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>NetCDF files can be huge (several gigabytes in size), but as they can be</span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>selectively read from and written to based on positions along grid</span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>dimensions, even remotely, they avoid unnecessary data transmission if read</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>remotely, or the need for enough RAM capacity to read the whole file at once.</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>As the files can be reopened to incrementally add data, once again, this can</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>be done efficiently and frequently. Remote access allowing selective download</span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>is implemented using the <span class="co">[</span><span class="ot">THREDDS</span><span class="co">](https://www.unidata.ucar.edu/software/tds/)</span></span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>, <span class="co">[</span><span class="ot">OPeNDAP</span><span class="co">](https://www.opendap.org/)</span></span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>and similar DAP servers (DAP is an acronym</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>for data access protocol). These servers can be accessed both interactively</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>though a web browser or through software such as from R or Python scripts.</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>When the file format is NetCDF some R packages make remote access consistent</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>with local file access, which is an advantage.</span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>The use of the NetCDF file format is widespread for meteorological and</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>geophysical data, but also used in other fields. NetCDF files are well</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>supported by software as the core software libraries needed are available for</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>free and are open-source. The format was developed by </span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">UniData</span><span class="co">](https://www.unidata.ucar.edu/software/netcdf/)</span> primarily for storing</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>geophysical data.</span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gridded data and interpolation</span></span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>Original data collected at ground level by weather stations are not available</span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>on a regular grid, but instead stations are irregularly distributed in space,</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>and measurements describe conditions at these specific locations. Data</span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>derived from satellite instrumentation are distributed following the overpass</span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>tracks and represent spatial averages as dictated by the resolution of the</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>cameras or other instruments. The merging of data from multiple sources,</span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>using models, receives the name of ``data assimilation''.</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>Many of the currently available climatological data sets integrate data from</span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>multiple sources, and re-express them on a regular grid to facilitate their</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>use. Spatial interpolation is used to achieve this, and obviously the</span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>uncertainty of the interpolated values as re-expressed on the grid depends on</span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>the density of observations available as well as their uncertainty. The</span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>interpolation process is also affected by topography, which even when</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>explicitly taken into account, adds to the uncertainty of the data. In these</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>data sets, the uncertainty varies among variables, as for example, more</span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>meteorological stations have instrumentation for air temperature than for</span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>global radiation. Depending on the data set, long term trends may be</span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>meaningful or not, as bias can be introduced by changes in the location of</span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>weather stations or more frequently by changes to their surroundings, say</span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>expansion of the built-up area of a city. Some data bases include data</span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>derived from the primary observations, such soil moisture or climatic water</span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>deficit. Obviously, when variables like potential evapotranspiration (PET) is</span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>derived from primary observations, uncertainties accumulate. As with any</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>derived or interpolated data, it is important to understand their origin,</span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>uncertainties involved and the use they have been designed for. Data sets are</span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>prepared with an objective in mind and validated for a certain use. For</span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>example, in some cases interpolation has prioritized the minimization or</span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>temporal biases and in other cases it has not.</span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>One final reminder: spatial grid density after interpolation does no longer</span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>reflect the spatial density of measurements. So if data are interpolated to a</span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>grid with 1/24 degree resolution using data from stations that are 100's of</span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>kilometers away, what we gain by gridding is not new information but only an</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>informed guess of what may have been the conditions at a location for</span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>which there is no data available. Sometimes, other information is used</span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>to improve the predictions, such as the elevation above sea level at each</span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>grid point. In any case, topography decreases the reliability of</span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>the gridded estimates in mountainous regions.</span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data use restrictions and acknowledgements</span></span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a>The data in each data base may have multiple origins and been subjected to</span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a>various processing steps. There is much personal effort and money invested in</span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a>them, and proper recognition is due to authors. In practice, continued</span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a>availability of these data resources depends on demonstration of their</span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a>usefulness and contribution to scientific progress and practical applications</span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>being demonstrated. This makes crucial that every user without exception</span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a>correctly acknowledges the use of open data sources.</span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a>The use of the data in these databases is subject to restrictions, for</span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a>example, E-OBS data cannot be used for commercial purposes, at least without</span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a>obtaining explicit authorization. Each database has instructions about how</span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a>the source should be acknowledged. Do check these before use and make sure to</span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a>comply with acknowledgements as requested by the authors. These restrictions and</span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a>specially how to cite the databases can change in time. For example when the</span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a>data set is updated or when a new article is published describing the data or</span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a>the method used. This means that in most cases we should use the most recent</span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a>version of the data, and always check the current use restrictions and</span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a>include the citation(s) and acknowledgement(s) as required or suggested at</span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a>the time we are preparing the publication-ready version of our manuscripts.</span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## The data bases</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a>I will show how to retrieve data from several databases containing data of</span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a>interest for research with plants and vegetation. Most databases provide</span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a>multiple ways to retrieve data, in most cases using the NetCDF file format</span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a>described above. Interactive access with a browser is demonstrated for E-OBS</span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a>in a video (Video S1), while here I demonstrate code-based data access,</span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a>download as well as some post-precessing with examples using R.</span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### TerraClimate</span></span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">TerraClimate</span><span class="co">](https://www.climatologylab.org/terraclimate.html)</span> provides </span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a>monthly data with worldwide coverage at a very high</span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a>resolution (1/24 degree), and in addition to monthly summaries for weather</span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a>measurements it contains several derived variables very useful for ecological</span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a>studies and agriculture (@tbl-terraclimate-vars). The data have</span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a>been validated against different measurements, but it must be remembered that</span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>the availability of primary data is very uneven across the Earth surface, and</span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>uncertainties vary accordingly. The data are derived from the assimilation of</span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>multiple data sources, including both surface and remote measurements. It</span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>is important to be aware that although the data are provided on a very</span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a>dense spatial grid, the original data are much more sparse, so the true</span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a>spatial resolution is not as fine as one would think at first sight. On</span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a>the other hand the interpolated values can in many cases be the best</span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a>approximation available to the unknown conditions at a given point in</span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>space.</span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a>| Variable   | Description                                                 |</span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>|:-----------|:------------------------------------------------------------|</span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a>| aet        | Actual Evapotranspiration, monthly total |</span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a>| def        | Climate Water Deficit, monthly total |</span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>| pet        | Potential evapotranspiration, monthly total |</span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>| ppt        | Precipitation, monthly total |</span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>| q          | Runoff, monthly total |</span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a>| soil       | Soil Moisture, total column at end of month |</span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>| srad       | Downward surface shortwave radiation |</span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a>| swe        | Snow water equivalent at end of month |</span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a>| tmax       | Max Temperature, average for month |</span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a>| tmin       | Min Temperature, average for month |</span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a>| vpd        | Vapor Pressure Deficit, average for month |</span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a>| vap        | Vapor pressure, average for month |</span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a>| ws         | Wind speed, average for month |</span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a>| PDSI       | Palmer Drought Severity Index, at end of month |</span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a>: Variables in the TerraClimate data set. Variables names used in</span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>  the data set and brief text descriptions. The metadata included in the</span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>  netCDF files provides up-to-date information on the units and basis</span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>  of expressing and there encoding in the files. {#tbl-terraclimate-vars}</span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a>TerraClimate also provides future climate projections developed for two</span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a>different climate futures: when global mean temperatures are (1) 2\,$^{\circ}$C and (2)</span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a>4\,$^{\circ}$C warmer than pre-industrial, and (2) when global mean temperatures are 4\,$^{\circ}$C</span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>above preindustrial. The future climate data are based on actual data from years</span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a>1985--2015, which for the manipulated data are called pseudo-years. The</span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a>values of variables for future climate are based on multiple simulation</span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a>models.</span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a>This data base supports the OPeNDAP protocol which allows selective download</span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a>from a remotely served NetCDF file, in addition to allowing download of the</span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a>whole data set and ready-made subsets. The data set has 37.3 million grid</span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a>points for 14 variables for each of 12 months for 61 years, i.e., $\approx</span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a>382\times10^9$ data values plus the values describing each of the coordinates</span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a>for each grid point. This is Big Data.</span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a>Once one understands how to remotely read a NetCDF file, and how to select</span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a>the observations from the 3D grid (latitude, longitude and time), the R code</span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a>needed is rather simple. In this case we need to download variables one by</span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a>one. The information we need to know is the URL to use. In this database the</span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a>URLs differ only by the name of the variable.</span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a>Package 'tidync' can be used to retrieve the data in one step directly getting a </span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a><span class="in">`tibble`</span>. There is </span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a>a difficulty when retrieving data: we need to know the coordinates for the</span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a>grid points that are nearest to our target locations. In this example we will</span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a>retrieve data for a single grid point and time.</span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidync)</span></span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, TC-02, message=FALSE}</span></span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a><span class="in">var="tmax"</span></span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a><span class="in">data_url &lt;- </span></span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a><span class="in">  paste0(paste0("http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_",</span></span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a><span class="in">                var),</span></span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a><span class="in">         "_1958_CurrentYear_GLOBE.nc")</span></span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a><span class="in">tnc &lt;- tidync(data_url)</span></span>
<span id="cb31-284"><a href="#cb31-284" aria-hidden="true" tabindex="-1"></a><span class="in">print(tnc)</span></span>
<span id="cb31-285"><a href="#cb31-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a><span class="in"># a single grid point</span></span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a><span class="in">my.lon &lt;- 45.05</span></span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a><span class="in">my.lat &lt;- 45.01</span></span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a><span class="in"># we need to take into account how values in variable time are stored</span></span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a><span class="in">my.month &lt;- as.integer(ymd("2015-06-01") - ymd("1900-01-01"))</span></span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a><span class="in"># we use tests as arguments for lon and lat to find the nearest grid point</span></span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a><span class="in">hyper_tibble(tnc,</span></span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a><span class="in">             lon = index == which.min(abs(lon - my.lon)),</span></span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a><span class="in">             lat = index == which.min(abs(lat - my.lat)),</span></span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a><span class="in">             time = time == my.month,</span></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a><span class="in">             na.rm = FALSE) %&gt;%</span></span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a><span class="in">  # convert time in number of days to a date</span></span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = ymd("1900-01-01") + days(time),</span></span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a><span class="in">         year = year(date),</span></span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a><span class="in">         month = month(date),</span></span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a><span class="in">         tmax = ifelse(abs(tmax) == 32768, NA, tmax)) %&gt;%</span></span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-time) -&gt; grid_point.tb</span></span>
<span id="cb31-304"><a href="#cb31-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-305"><a href="#cb31-305" aria-hidden="true" tabindex="-1"></a><span class="in"># print the result</span></span>
<span id="cb31-306"><a href="#cb31-306" aria-hidden="true" tabindex="-1"></a><span class="in">grid_point.tb</span></span>
<span id="cb31-307"><a href="#cb31-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-308"><a href="#cb31-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-309"><a href="#cb31-309" aria-hidden="true" tabindex="-1"></a>We continue from the previous example retrieving data from all grid points</span>
<span id="cb31-310"><a href="#cb31-310" aria-hidden="true" tabindex="-1"></a>within an area and for a time period. To save typing we define a function,</span>
<span id="cb31-311"><a href="#cb31-311" aria-hidden="true" tabindex="-1"></a>which, thanks to its name, makes also clear the intention of the code.</span>
<span id="cb31-312"><a href="#cb31-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-313"><a href="#cb31-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, TC-03, message=FALSE}</span></span>
<span id="cb31-314"><a href="#cb31-314" aria-hidden="true" tabindex="-1"></a><span class="in">is_within &lt;- function(x, range) {</span></span>
<span id="cb31-315"><a href="#cb31-315" aria-hidden="true" tabindex="-1"></a><span class="in">  # protect from ranges given backwards</span></span>
<span id="cb31-316"><a href="#cb31-316" aria-hidden="true" tabindex="-1"></a><span class="in">  range &lt;- range(range)</span></span>
<span id="cb31-317"><a href="#cb31-317" aria-hidden="true" tabindex="-1"></a><span class="in">  x &gt; range[1] &amp; x &lt; range[2]</span></span>
<span id="cb31-318"><a href="#cb31-318" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb31-319"><a href="#cb31-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-320"><a href="#cb31-320" aria-hidden="true" tabindex="-1"></a><span class="in"># we save the limits to variables</span></span>
<span id="cb31-321"><a href="#cb31-321" aria-hidden="true" tabindex="-1"></a><span class="in">my.lon &lt;- c(50, 50.5)</span></span>
<span id="cb31-322"><a href="#cb31-322" aria-hidden="true" tabindex="-1"></a><span class="in">my.lat &lt;- c(30.5, 31)</span></span>
<span id="cb31-323"><a href="#cb31-323" aria-hidden="true" tabindex="-1"></a><span class="in">my.period &lt;- as.integer(ymd(c("1960-03-01", "1960-09-01")) - ymd("1900-01-01"))</span></span>
<span id="cb31-324"><a href="#cb31-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-325"><a href="#cb31-325" aria-hidden="true" tabindex="-1"></a><span class="in">hyper_tibble(tnc,</span></span>
<span id="cb31-326"><a href="#cb31-326" aria-hidden="true" tabindex="-1"></a><span class="in">             lon = is_within(lon, my.lon),</span></span>
<span id="cb31-327"><a href="#cb31-327" aria-hidden="true" tabindex="-1"></a><span class="in">             lat = is_within(lat, my.lat),</span></span>
<span id="cb31-328"><a href="#cb31-328" aria-hidden="true" tabindex="-1"></a><span class="in">             time = is_within(time, my.period),</span></span>
<span id="cb31-329"><a href="#cb31-329" aria-hidden="true" tabindex="-1"></a><span class="in">             na.rm = FALSE) %&gt;%</span></span>
<span id="cb31-330"><a href="#cb31-330" aria-hidden="true" tabindex="-1"></a><span class="in">  # convert time in number of days to a date</span></span>
<span id="cb31-331"><a href="#cb31-331" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = ymd("1900-01-01") + days(time),</span></span>
<span id="cb31-332"><a href="#cb31-332" aria-hidden="true" tabindex="-1"></a><span class="in">         year = year(date),</span></span>
<span id="cb31-333"><a href="#cb31-333" aria-hidden="true" tabindex="-1"></a><span class="in">         month = month(date),</span></span>
<span id="cb31-334"><a href="#cb31-334" aria-hidden="true" tabindex="-1"></a><span class="in">         tmax = ifelse(abs(tmax) == 32768, NA, tmax)) %&gt;%</span></span>
<span id="cb31-335"><a href="#cb31-335" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-time) -&gt; grid_area_in_time.tb</span></span>
<span id="cb31-336"><a href="#cb31-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-337"><a href="#cb31-337" aria-hidden="true" tabindex="-1"></a><span class="in">grid_area_in_time.tb</span></span>
<span id="cb31-338"><a href="#cb31-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-339"><a href="#cb31-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-340"><a href="#cb31-340" aria-hidden="true" tabindex="-1"></a>In principle we could download the whole files, and access them</span>
<span id="cb31-341"><a href="#cb31-341" aria-hidden="true" tabindex="-1"></a>locally, but the catch is in the size of the files: up to a few GB per</span>
<span id="cb31-342"><a href="#cb31-342" aria-hidden="true" tabindex="-1"></a>variable. For this reason, unless we plan to use a large chunk of the data,</span>
<span id="cb31-343"><a href="#cb31-343" aria-hidden="true" tabindex="-1"></a>or repeatedly extract different subsets</span>
<span id="cb31-344"><a href="#cb31-344" aria-hidden="true" tabindex="-1"></a>it is more efficient to use selective downloads.</span>
<span id="cb31-345"><a href="#cb31-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-346"><a href="#cb31-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### E-OBS</span></span>
<span id="cb31-347"><a href="#cb31-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-348"><a href="#cb31-348" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">E-OBS</span><span class="co">](https://surfobs.climate.copernicus.eu)</span> <span class="co">[</span><span class="ot">@Cornes2018</span><span class="co">]</span> covers Europe plus</span>
<span id="cb31-349"><a href="#cb31-349" aria-hidden="true" tabindex="-1"></a>nearby regions including land bordering the Mediterranean sea to the South</span>
<span id="cb31-350"><a href="#cb31-350" aria-hidden="true" tabindex="-1"></a>and East. Data is daily and based on measurements at thousands of weather</span>
<span id="cb31-351"><a href="#cb31-351" aria-hidden="true" tabindex="-1"></a>stations and extends at the time of writing from 1920-01-01 to 2023-07-30.</span>
<span id="cb31-352"><a href="#cb31-352" aria-hidden="true" tabindex="-1"></a>These data have estimates of uncertainty for each variable, grid and time</span>
<span id="cb31-353"><a href="#cb31-353" aria-hidden="true" tabindex="-1"></a>point. The maximum spatial resolution available is 1/10 degree for both</span>
<span id="cb31-354"><a href="#cb31-354" aria-hidden="true" tabindex="-1"></a>latitude and longitude. Download of data is free but requires registration.</span>
<span id="cb31-355"><a href="#cb31-355" aria-hidden="true" tabindex="-1"></a>Data is restricted to non-commercial use. In this case, after logging-in into</span>
<span id="cb31-356"><a href="#cb31-356" aria-hidden="true" tabindex="-1"></a>the web site one can download the NetCDF files to a local disk (Video:</span>
<span id="cb31-357"><a href="#cb31-357" aria-hidden="true" tabindex="-1"></a>XXXXX). Once downloaded, as a second step, one can access the file as shown</span>
<span id="cb31-358"><a href="#cb31-358" aria-hidden="true" tabindex="-1"></a>above for TerraClimate data. The most reliable data are from 1950 to the</span>
<span id="cb31-359"><a href="#cb31-359" aria-hidden="true" tabindex="-1"></a>present, and at 1/10 degree resolution. Files contain data for a single</span>
<span id="cb31-360"><a href="#cb31-360" aria-hidden="true" tabindex="-1"></a>variable, and are large (6 to 15 GB each). Estimates of uncertainty are also</span>
<span id="cb31-361"><a href="#cb31-361" aria-hidden="true" tabindex="-1"></a>in individual files, one per variable.</span>
<span id="cb31-362"><a href="#cb31-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-363"><a href="#cb31-363" aria-hidden="true" tabindex="-1"></a>We can adjust the code shown above to work with these files. First step is to</span>
<span id="cb31-364"><a href="#cb31-364" aria-hidden="true" tabindex="-1"></a>use a file path instead of an URL. When exploring the properties of the file</span>
<span id="cb31-365"><a href="#cb31-365" aria-hidden="true" tabindex="-1"></a>we can notice some differences, even in the names of the grid variables and how</span>
<span id="cb31-366"><a href="#cb31-366" aria-hidden="true" tabindex="-1"></a>time is encoded (the starting date is different).</span>
<span id="cb31-367"><a href="#cb31-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-368"><a href="#cb31-368" aria-hidden="true" tabindex="-1"></a>OPeNDAP access is available at (http://opendap.knmi.nl/knmi/thredds/dodsC/)</span>
<span id="cb31-369"><a href="#cb31-369" aria-hidden="true" tabindex="-1"></a>through a THREDDS server maintained by the Royal Netherlands Meteorological</span>
<span id="cb31-370"><a href="#cb31-370" aria-hidden="true" tabindex="-1"></a>Institute, but the version currently available is two years behind the</span>
<span id="cb31-371"><a href="#cb31-371" aria-hidden="true" tabindex="-1"></a>Copernicus server of EU. With <span class="in">`catalog.html`</span> listing the data sets and</span>
<span id="cb31-372"><a href="#cb31-372" aria-hidden="true" tabindex="-1"></a>for example the link ending in</span>
<span id="cb31-373"><a href="#cb31-373" aria-hidden="true" tabindex="-1"></a><span class="in">`e-obs_0.25regular/tg_0.25deg_reg_v17.0.nc`</span> giving access to the variable</span>
<span id="cb31-374"><a href="#cb31-374" aria-hidden="true" tabindex="-1"></a><span class="in">`tg`</span> with daily mean air temperature.</span>
<span id="cb31-375"><a href="#cb31-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-376"><a href="#cb31-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb31-377"><a href="#cb31-377" aria-hidden="true" tabindex="-1"></a><span class="in"># We will use local file downloaded from web page</span></span>
<span id="cb31-378"><a href="#cb31-378" aria-hidden="true" tabindex="-1"></a><span class="in"># This file is nearly 800 MB in size but online query is cumbersome for this</span></span>
<span id="cb31-379"><a href="#cb31-379" aria-hidden="true" tabindex="-1"></a><span class="in"># server.</span></span>
<span id="cb31-380"><a href="#cb31-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-381"><a href="#cb31-381" aria-hidden="true" tabindex="-1"></a><span class="in">eobs_tnc &lt;- tidync("data/tg_ens_mean_0.25deg_reg_v27.0e.nc")</span></span>
<span id="cb31-382"><a href="#cb31-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-383"><a href="#cb31-383" aria-hidden="true" tabindex="-1"></a><span class="in">activate(eobs_tnc, "tg")</span></span>
<span id="cb31-384"><a href="#cb31-384" aria-hidden="true" tabindex="-1"></a><span class="in">print(eobs_tnc)</span></span>
<span id="cb31-385"><a href="#cb31-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-386"><a href="#cb31-386" aria-hidden="true" tabindex="-1"></a><span class="in"># we save the limits to variables</span></span>
<span id="cb31-387"><a href="#cb31-387" aria-hidden="true" tabindex="-1"></a><span class="in">my.lon &lt;- c(-30, -10)</span></span>
<span id="cb31-388"><a href="#cb31-388" aria-hidden="true" tabindex="-1"></a><span class="in">my.lat &lt;- c(55, 65)</span></span>
<span id="cb31-389"><a href="#cb31-389" aria-hidden="true" tabindex="-1"></a><span class="in">my.period &lt;- as.integer(ymd(c("2020-03-01", "2021-09-01")) - ymd("1950-01-01"))</span></span>
<span id="cb31-390"><a href="#cb31-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-391"><a href="#cb31-391" aria-hidden="true" tabindex="-1"></a><span class="in">hyper_tibble(eobs_tnc,</span></span>
<span id="cb31-392"><a href="#cb31-392" aria-hidden="true" tabindex="-1"></a><span class="in">             longitude = is_within(longitude, my.lon),</span></span>
<span id="cb31-393"><a href="#cb31-393" aria-hidden="true" tabindex="-1"></a><span class="in">             latitude = is_within(latitude, my.lat),</span></span>
<span id="cb31-394"><a href="#cb31-394" aria-hidden="true" tabindex="-1"></a><span class="in">             time = is_within(time, my.period),</span></span>
<span id="cb31-395"><a href="#cb31-395" aria-hidden="true" tabindex="-1"></a><span class="in">             na.rm = FALSE) %&gt;%</span></span>
<span id="cb31-396"><a href="#cb31-396" aria-hidden="true" tabindex="-1"></a><span class="in">  # convert time in number of days to a date</span></span>
<span id="cb31-397"><a href="#cb31-397" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(date = ymd("1950-01-01") + days(time),</span></span>
<span id="cb31-398"><a href="#cb31-398" aria-hidden="true" tabindex="-1"></a><span class="in">         year = year(date),</span></span>
<span id="cb31-399"><a href="#cb31-399" aria-hidden="true" tabindex="-1"></a><span class="in">         month = month(date)) %&gt;%</span></span>
<span id="cb31-400"><a href="#cb31-400" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-time) -&gt; grid_area_in_time.tb</span></span>
<span id="cb31-401"><a href="#cb31-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-402"><a href="#cb31-402" aria-hidden="true" tabindex="-1"></a><span class="in">sum(!is.na(grid_area_in_time.tb$tg))</span></span>
<span id="cb31-403"><a href="#cb31-403" aria-hidden="true" tabindex="-1"></a><span class="in">sum(is.na(grid_area_in_time.tb$tg))</span></span>
<span id="cb31-404"><a href="#cb31-404" aria-hidden="true" tabindex="-1"></a><span class="in">print(na.omit(grid_area_in_time.tb))</span></span>
<span id="cb31-405"><a href="#cb31-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-406"><a href="#cb31-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-407"><a href="#cb31-407" aria-hidden="true" tabindex="-1"></a>From here onwards we can continue as shown above for TerraClimate, but replacing the starting date</span>
<span id="cb31-408"><a href="#cb31-408" aria-hidden="true" tabindex="-1"></a>for time of <span class="in">`ymd("1900-01-01")`</span> by <span class="in">`ymd("1950-01-01")`</span> and the missing value</span>
<span id="cb31-409"><a href="#cb31-409" aria-hidden="true" tabindex="-1"></a>marker <span class="in">`32768`</span> by <span class="in">`9999`</span>. These values are taken from the metadata</span>
<span id="cb31-410"><a href="#cb31-410" aria-hidden="true" tabindex="-1"></a>we printed with the code above.</span>
<span id="cb31-411"><a href="#cb31-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-412"><a href="#cb31-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### NASA POWER</span></span>
<span id="cb31-413"><a href="#cb31-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-414"><a href="#cb31-414" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">NASA POWER</span><span class="co">](https://power.larc.nasa.gov)</span> hosts data mainly intended for</span>
<span id="cb31-415"><a href="#cb31-415" aria-hidden="true" tabindex="-1"></a>renewable energy estimates such as temperature, relative humidity,</span>
<span id="cb31-416"><a href="#cb31-416" aria-hidden="true" tabindex="-1"></a>precipitation, solar radiation, clouds, wind speed and wind direction, all in</span>
<span id="cb31-417"><a href="#cb31-417" aria-hidden="true" tabindex="-1"></a>all data for 161 parameters. The maximum spatial resolution available is 1/10</span>
<span id="cb31-418"><a href="#cb31-418" aria-hidden="true" tabindex="-1"></a>degree for both latitude and longitude. Geographic coverage is global, hourly</span>
<span id="cb31-419"><a href="#cb31-419" aria-hidden="true" tabindex="-1"></a>values are available in near-real-time. Gridded values are based on remote</span>
<span id="cb31-420"><a href="#cb31-420" aria-hidden="true" tabindex="-1"></a>data acquired with satellite instruments.  The available solar and weather</span>
<span id="cb31-421"><a href="#cb31-421" aria-hidden="true" tabindex="-1"></a>data can be useful for other purposes in addition to renewable energy</span>
<span id="cb31-422"><a href="#cb31-422" aria-hidden="true" tabindex="-1"></a>assessments. These data can be accessed using R package 'nasapower' built on</span>
<span id="cb31-423"><a href="#cb31-423" aria-hidden="true" tabindex="-1"></a>top of the online API. In this case, the data set specific package works</span>
<span id="cb31-424"><a href="#cb31-424" aria-hidden="true" tabindex="-1"></a>differently, returning a tibble, without exposing NetCDF files to the user.</span>
<span id="cb31-425"><a href="#cb31-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-426"><a href="#cb31-426" aria-hidden="true" tabindex="-1"></a>In the case of NASA POWER any valid longitude and altitude can be passed, so</span>
<span id="cb31-427"><a href="#cb31-427" aria-hidden="true" tabindex="-1"></a>we do not need to define R code to search for the nearest available grid</span>
<span id="cb31-428"><a href="#cb31-428" aria-hidden="true" tabindex="-1"></a>point as we did above. In addition, the value passed to <span class="in">`community`</span></span>
<span id="cb31-429"><a href="#cb31-429" aria-hidden="true" tabindex="-1"></a>parameter affects the units in which the values are returned. By passing</span>
<span id="cb31-430"><a href="#cb31-430" aria-hidden="true" tabindex="-1"></a><span class="in">`"AG"`</span>, for agro-climatology, we obtain the radiation in MJ/m-2/d-1.</span>
<span id="cb31-431"><a href="#cb31-431" aria-hidden="true" tabindex="-1"></a>Metadata is also retrieved and stored in the object containing the data.</span>
<span id="cb31-432"><a href="#cb31-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-433"><a href="#cb31-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, NP-01}</span></span>
<span id="cb31-434"><a href="#cb31-434" aria-hidden="true" tabindex="-1"></a><span class="in">library(nasapower)</span></span>
<span id="cb31-435"><a href="#cb31-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-436"><a href="#cb31-436" aria-hidden="true" tabindex="-1"></a><span class="in"># long printout, use to se what is available</span></span>
<span id="cb31-437"><a href="#cb31-437" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb31-438"><a href="#cb31-438" aria-hidden="true" tabindex="-1"></a><span class="in"># query_parameters(community = "ag",</span></span>
<span id="cb31-439"><a href="#cb31-439" aria-hidden="true" tabindex="-1"></a><span class="in">#                  temporal_api = "hourly")</span></span>
<span id="cb31-440"><a href="#cb31-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-441"><a href="#cb31-441" aria-hidden="true" tabindex="-1"></a><span class="in">query_parameters(par = "T2M",</span></span>
<span id="cb31-442"><a href="#cb31-442" aria-hidden="true" tabindex="-1"></a><span class="in">                 community = "ag",</span></span>
<span id="cb31-443"><a href="#cb31-443" aria-hidden="true" tabindex="-1"></a><span class="in">                 temporal_api = "hourly")</span></span>
<span id="cb31-444"><a href="#cb31-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-445"><a href="#cb31-445" aria-hidden="true" tabindex="-1"></a><span class="in"># we download the data for one grid point, Joensuu, Finland</span></span>
<span id="cb31-446"><a href="#cb31-446" aria-hidden="true" tabindex="-1"></a><span class="in">daily_single_ag &lt;- get_power(</span></span>
<span id="cb31-447"><a href="#cb31-447" aria-hidden="true" tabindex="-1"></a><span class="in">  community = "AG",</span></span>
<span id="cb31-448"><a href="#cb31-448" aria-hidden="true" tabindex="-1"></a><span class="in">  lonlat = c(29.76, 62.60),</span></span>
<span id="cb31-449"><a href="#cb31-449" aria-hidden="true" tabindex="-1"></a><span class="in">  pars = c("RH2M", "T2M", "ALLSKY_SFC_SW_DWN"),</span></span>
<span id="cb31-450"><a href="#cb31-450" aria-hidden="true" tabindex="-1"></a><span class="in">  dates = c("2020-06-01", "2020-06-30"),</span></span>
<span id="cb31-451"><a href="#cb31-451" aria-hidden="true" tabindex="-1"></a><span class="in">  temporal_average = "DAILY"</span></span>
<span id="cb31-452"><a href="#cb31-452" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb31-453"><a href="#cb31-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-454"><a href="#cb31-454" aria-hidden="true" tabindex="-1"></a><span class="in"># print the downloaded data</span></span>
<span id="cb31-455"><a href="#cb31-455" aria-hidden="true" tabindex="-1"></a><span class="in">daily_single_ag</span></span>
<span id="cb31-456"><a href="#cb31-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-457"><a href="#cb31-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-458"><a href="#cb31-458" aria-hidden="true" tabindex="-1"></a>We must be aware that near-real-time data from remote</span>
<span id="cb31-459"><a href="#cb31-459" aria-hidden="true" tabindex="-1"></a>sensing is not subjected to as thorough a quality control as</span>
<span id="cb31-460"><a href="#cb31-460" aria-hidden="true" tabindex="-1"></a>validated data made available with a longer delay.</span>
<span id="cb31-461"><a href="#cb31-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-462"><a href="#cb31-462" aria-hidden="true" tabindex="-1"></a><span class="fu">### Erythemal UV radiation and ozone column</span></span>
<span id="cb31-463"><a href="#cb31-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-464"><a href="#cb31-464" aria-hidden="true" tabindex="-1"></a>We will import data from a file downloaded manually (using URL https://avdc.gsfc.nasa.gov/index.php?site=164609600&amp;id=79) and corresponding to Ushuaia, Argentina.</span>
<span id="cb31-465"><a href="#cb31-465" aria-hidden="true" tabindex="-1"></a>When we first download data from a server as a text file, we need to inspect it. Most files will have a header with metadata and which needs to be read separately from the data itself. In this case, opening the file in a text editor, such as RStudio, notepad or nano, we can see that lines from 51 onwards contain the data in tabular shape and that line</span>
<span id="cb31-466"><a href="#cb31-466" aria-hidden="true" tabindex="-1"></a>51 contains the variable (= column) names. From this we know that we need to separately read the first 50 lines as a header, and that for reading the data themselves we need to skip 50 lines at the top of the file.</span>
<span id="cb31-467"><a href="#cb31-467" aria-hidden="true" tabindex="-1"></a>We save to the header in the 'comment' attribute of the data frame.</span>
<span id="cb31-468"><a href="#cb31-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-469"><a href="#cb31-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, OMIUV-01}</span></span>
<span id="cb31-470"><a href="#cb31-470" aria-hidden="true" tabindex="-1"></a><span class="in">library(readr)</span></span>
<span id="cb31-471"><a href="#cb31-471" aria-hidden="true" tabindex="-1"></a><span class="in">library(anytime)</span></span>
<span id="cb31-472"><a href="#cb31-472" aria-hidden="true" tabindex="-1"></a><span class="in">my.file &lt;- "data/aura_omi_l2ovp_omuvb_v03_ushuaia.txt"</span></span>
<span id="cb31-473"><a href="#cb31-473" aria-hidden="true" tabindex="-1"></a><span class="in">header &lt;- readLines(my.file, n = 50)</span></span>
<span id="cb31-474"><a href="#cb31-474" aria-hidden="true" tabindex="-1"></a><span class="in">omiuvb.tb &lt;- read_table(file = my.file,</span></span>
<span id="cb31-475"><a href="#cb31-475" aria-hidden="true" tabindex="-1"></a><span class="in">                        skip = 50,</span></span>
<span id="cb31-476"><a href="#cb31-476" aria-hidden="true" tabindex="-1"></a><span class="in">                        col_types = cols(.default = col_double(),</span></span>
<span id="cb31-477"><a href="#cb31-477" aria-hidden="true" tabindex="-1"></a><span class="in">                                         Datetime = col_character(),</span></span>
<span id="cb31-478"><a href="#cb31-478" aria-hidden="true" tabindex="-1"></a><span class="in">                                         DOY = col_integer(),</span></span>
<span id="cb31-479"><a href="#cb31-479" aria-hidden="true" tabindex="-1"></a><span class="in">                                         Orbit = col_character()))</span></span>
<span id="cb31-480"><a href="#cb31-480" aria-hidden="true" tabindex="-1"></a><span class="in">comment(omiuvb.tb) &lt;- header</span></span>
<span id="cb31-481"><a href="#cb31-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-482"><a href="#cb31-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-483"><a href="#cb31-483" aria-hidden="true" tabindex="-1"></a>We will most likely be interested in a few of the columns rather than in all</span>
<span id="cb31-484"><a href="#cb31-484" aria-hidden="true" tabindex="-1"></a>of them. We can inspect the header of the file itself, or the documentation</span>
<span id="cb31-485"><a href="#cb31-485" aria-hidden="true" tabindex="-1"></a>of the data set to identify the columns containing the data we need, and then</span>
<span id="cb31-486"><a href="#cb31-486" aria-hidden="true" tabindex="-1"></a>select these columns and study the description of these fields, and as shown</span>
<span id="cb31-487"><a href="#cb31-487" aria-hidden="true" tabindex="-1"></a>below.</span>
<span id="cb31-488"><a href="#cb31-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-489"><a href="#cb31-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, OMIUV-02}</span></span>
<span id="cb31-490"><a href="#cb31-490" aria-hidden="true" tabindex="-1"></a><span class="in"># cat(grkmisc::pretty_string(comment(omiuvb.tb), wrap_at = 70, truncate_at = Inf), sep =  "\n")</span></span>
<span id="cb31-491"><a href="#cb31-491" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(omiuvb.tb)</span></span>
<span id="cb31-492"><a href="#cb31-492" aria-hidden="true" tabindex="-1"></a><span class="in">column_selector &lt;-  c("Year", "DOY", "OMTO3_O3", "EDDose", "UVBQF", "OMQF")</span></span>
<span id="cb31-493"><a href="#cb31-493" aria-hidden="true" tabindex="-1"></a><span class="in">pattern &lt;- paste(column_selector, collapse = "|")</span></span>
<span id="cb31-494"><a href="#cb31-494" aria-hidden="true" tabindex="-1"></a><span class="in">header[grepl(pattern, header)]</span></span>
<span id="cb31-495"><a href="#cb31-495" aria-hidden="true" tabindex="-1"></a><span class="in">omiuvb.tb[ , column_selector]</span></span>
<span id="cb31-496"><a href="#cb31-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-497"><a href="#cb31-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-498"><a href="#cb31-498" aria-hidden="true" tabindex="-1"></a>These data originate from satellite observations and are based on cloudiness</span>
<span id="cb31-499"><a href="#cb31-499" aria-hidden="true" tabindex="-1"></a>and aerosols as observed during overpass. Ozone column values are more</span>
<span id="cb31-500"><a href="#cb31-500" aria-hidden="true" tabindex="-1"></a>reliable than erythemal UV doses, as ozone column thickness varies very</span>
<span id="cb31-501"><a href="#cb31-501" aria-hidden="true" tabindex="-1"></a>little between overpasses while cloudiness can vary much more. EDDose can be</span>
<span id="cb31-502"><a href="#cb31-502" aria-hidden="true" tabindex="-1"></a>up to 30% overestimated. It is important to read the data product</span>
<span id="cb31-503"><a href="#cb31-503" aria-hidden="true" tabindex="-1"></a>documentation before using the data and to understand the meaning of the</span>
<span id="cb31-504"><a href="#cb31-504" aria-hidden="true" tabindex="-1"></a>quality flags, as some observations may need to be discarded. Estimates are</span>
<span id="cb31-505"><a href="#cb31-505" aria-hidden="true" tabindex="-1"></a>specially unreliable when there is a snow or ice cover on the ground as it</span>
<span id="cb31-506"><a href="#cb31-506" aria-hidden="true" tabindex="-1"></a>affects estimates of cloudiness.</span>
<span id="cb31-507"><a href="#cb31-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-508"><a href="#cb31-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-509"><a href="#cb31-509" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other data sources</span></span>
<span id="cb31-510"><a href="#cb31-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-511"><a href="#cb31-511" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">European Centre for Medium-Range Weather Forecasts</span><span class="co">](https://www.ecmwf.int/)</span> </span>
<span id="cb31-512"><a href="#cb31-512" aria-hidden="true" tabindex="-1"></a>is another source of useful data. For example the "ECMWF Reanalysis</span>
<span id="cb31-513"><a href="#cb31-513" aria-hidden="true" tabindex="-1"></a>v5" or ERA5 is a reanalysis of world-wide weather going back all the way to</span>
<span id="cb31-514"><a href="#cb31-514" aria-hidden="true" tabindex="-1"></a><span class="ss">1950. </span>These data rely more strongly on modelling but the highest temporal</span>
<span id="cb31-515"><a href="#cb31-515" aria-hidden="true" tabindex="-1"></a>resolution available is hourly. The file format used is not NetCDF but,</span>
<span id="cb31-516"><a href="#cb31-516" aria-hidden="true" tabindex="-1"></a>instead, GRIB.</span>
<span id="cb31-517"><a href="#cb31-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-518"><a href="#cb31-518" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">National Oceanic and Atmospheric Administration</span><span class="co">](https://www.noaa.gov/)</span> (NOAA) in the USA,</span>
<span id="cb31-519"><a href="#cb31-519" aria-hidden="true" tabindex="-1"></a>has for many years provided open access to data. Both data sets with</span>
<span id="cb31-520"><a href="#cb31-520" aria-hidden="true" tabindex="-1"></a>national and world-wide coverage are hosted. The R package 'rNOMADS'</span>
<span id="cb31-521"><a href="#cb31-521" aria-hidden="true" tabindex="-1"></a>facilitates access to these data.</span>
<span id="cb31-522"><a href="#cb31-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-523"><a href="#cb31-523" aria-hidden="true" tabindex="-1"></a>Various national weather services also make at least some data available</span>
<span id="cb31-524"><a href="#cb31-524" aria-hidden="true" tabindex="-1"></a>on-line as part of the recent emphasis on "open government". For example,</span>
<span id="cb31-525"><a href="#cb31-525" aria-hidden="true" tabindex="-1"></a>for Spain precipitation data with less uncertainty than that in E-OBS is</span>
<span id="cb31-526"><a href="#cb31-526" aria-hidden="true" tabindex="-1"></a>available. In the case of Finland, historical data from meteorological</span>
<span id="cb31-527"><a href="#cb31-527" aria-hidden="true" tabindex="-1"></a>stations is one of the data sets available on-line through an API interface</span>
<span id="cb31-528"><a href="#cb31-528" aria-hidden="true" tabindex="-1"></a>giving access to several variables from </span>
<span id="cb31-529"><a href="#cb31-529" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">FMI</span><span class="co">](https://en.ilmatieteenlaitos.fi/open-data-sets-available)</span>. In this</span>
<span id="cb31-530"><a href="#cb31-530" aria-hidden="true" tabindex="-1"></a>case there is a well documented R package which has not yet been published in</span>
<span id="cb31-531"><a href="#cb31-531" aria-hidden="true" tabindex="-1"></a>CRAN but that can be installed from a git repository hosted at </span>
<span id="cb31-532"><a href="#cb31-532" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">GitHub</span><span class="co">](https://github.com/rOpenGov/fmi2)</span>.</span>
<span id="cb31-533"><a href="#cb31-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-534"><a href="#cb31-534" aria-hidden="true" tabindex="-1"></a>NASA maintains a metadata catalogue for </span>
<span id="cb31-535"><a href="#cb31-535" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Earth Observation Data</span><span class="co">](https://earthdata.nasa.gov/)</span>. At this site there is a link <span class="co">[</span><span class="ot">"Find Data"</span><span class="co">](https://www.earthdata.nasa.gov/learn/find-data)</span> allowing searches.</span>
<span id="cb31-536"><a href="#cb31-536" aria-hidden="true" tabindex="-1"></a>Searching the catalogue can be overwhelming unless one starts by limiting the</span>
<span id="cb31-537"><a href="#cb31-537" aria-hidden="true" tabindex="-1"></a>scope of data sources where to search, say by type of instrument, or some</span>
<span id="cb31-538"><a href="#cb31-538" aria-hidden="true" tabindex="-1"></a>other broad criterion.</span>
<span id="cb31-539"><a href="#cb31-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-540"><a href="#cb31-540" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">CEOS International Directory Network (IDN)</span><span class="co">](https://idn.ceos.org/)</span> can be</span>
<span id="cb31-541"><a href="#cb31-541" aria-hidden="true" tabindex="-1"></a>also of help. For example, searching for "ozone</span>
<span id="cb31-542"><a href="#cb31-542" aria-hidden="true" tabindex="-1"></a>layer" and then selecting "OMI" as instrument provides a list of useful</span>
<span id="cb31-543"><a href="#cb31-543" aria-hidden="true" tabindex="-1"></a>data sets of manageable length.</span>
<span id="cb31-544"><a href="#cb31-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-545"><a href="#cb31-545" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">NASA's World View</span><span class="co">](https://worldview.earthdata.nasa.gov/)</span> makes</span>
<span id="cb31-546"><a href="#cb31-546" aria-hidden="true" tabindex="-1"></a>it possible to interactively explore data sets graphically as "layers" on a</span>
<span id="cb31-547"><a href="#cb31-547" aria-hidden="true" tabindex="-1"></a>world map, but also provides links to download the same data as numerical</span>
<span id="cb31-548"><a href="#cb31-548" aria-hidden="true" tabindex="-1"></a>values. Some data are also available through the </span>
<span id="cb31-549"><a href="#cb31-549" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Google Earth Engine</span><span class="co">](https://explorer.earthengine.google.com/)</span> after creating</span>
<span id="cb31-550"><a href="#cb31-550" aria-hidden="true" tabindex="-1"></a>a user account.</span>
<span id="cb31-551"><a href="#cb31-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-552"><a href="#cb31-552" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">UNdata site</span><span class="co">](https://data.un.org/)</span> gives access to</span>
<span id="cb31-553"><a href="#cb31-553" aria-hidden="true" tabindex="-1"></a>world-wide and country statistics including the data from the [World</span>
<span id="cb31-554"><a href="#cb31-554" aria-hidden="true" tabindex="-1"></a>Meteorological Organization](https://public.wmo.int/en).</span>
<span id="cb31-555"><a href="#cb31-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-556"><a href="#cb31-556" aria-hidden="true" tabindex="-1"></a>Although off-topic, it is worthwhile mentioning that other types of data</span>
<span id="cb31-557"><a href="#cb31-557" aria-hidden="true" tabindex="-1"></a>useful in our research are also becoming available on-line. These data sets include several related to species distributions, phenology and other data relevant to ecological research. In many cases,</span>
<span id="cb31-558"><a href="#cb31-558" aria-hidden="true" tabindex="-1"></a>specific R packages are available for retrieval and import of the data.</span>
<span id="cb31-559"><a href="#cb31-559" aria-hidden="true" tabindex="-1"></a>For R users it is worthwhile keeping a close eye on the </span>
<span id="cb31-560"><a href="#cb31-560" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">ROpenScience web site</span><span class="co">](https://ropensci.org/)</span> and on their <span class="co">[</span><span class="ot">catalogue of peer-reviewed R packages</span><span class="co">](https://ropensci.org/packages/data-access/)</span>.</span>
<span id="cb31-561"><a href="#cb31-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-562"><a href="#cb31-562" aria-hidden="true" tabindex="-1"></a>\section*{Additional thoughts}</span>
<span id="cb31-563"><a href="#cb31-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-564"><a href="#cb31-564" aria-hidden="true" tabindex="-1"></a>Few researchers in our field, including myself, extract all the information</span>
<span id="cb31-565"><a href="#cb31-565" aria-hidden="true" tabindex="-1"></a>contained in the data they collect. Fewer, extract all the information</span>
<span id="cb31-566"><a href="#cb31-566" aria-hidden="true" tabindex="-1"></a>obtainable by combining the data they collect with data about the context in</span>
<span id="cb31-567"><a href="#cb31-567" aria-hidden="true" tabindex="-1"></a>which they do research. Even fewer quantitatively combine data over long</span>
<span id="cb31-568"><a href="#cb31-568" aria-hidden="true" tabindex="-1"></a>periods or time, across research groups, institutions, countries, and</span>
<span id="cb31-569"><a href="#cb31-569" aria-hidden="true" tabindex="-1"></a>continents, etc. In contrast, meteorologists do it all the time: they extract</span>
<span id="cb31-570"><a href="#cb31-570" aria-hidden="true" tabindex="-1"></a>information, about very slow rates of change with background variation that</span>
<span id="cb31-571"><a href="#cb31-571" aria-hidden="true" tabindex="-1"></a>is comparatively huge. How do they achieve this? Extreme care about methods:</span>
<span id="cb31-572"><a href="#cb31-572" aria-hidden="true" tabindex="-1"></a>calibrations, cross-calibrations, and all sorts validations, cross</span>
<span id="cb31-573"><a href="#cb31-573" aria-hidden="true" tabindex="-1"></a>validations and inter-comparisons. What does this mean in practice? With</span>
<span id="cb31-574"><a href="#cb31-574" aria-hidden="true" tabindex="-1"></a>careful computations and further validation they can produce long time series</span>
<span id="cb31-575"><a href="#cb31-575" aria-hidden="true" tabindex="-1"></a>of data covering most of our planet, based on measurements done by many</span>
<span id="cb31-576"><a href="#cb31-576" aria-hidden="true" tabindex="-1"></a>thousands, possibly even millions, of different observers, sometimes using</span>
<span id="cb31-577"><a href="#cb31-577" aria-hidden="true" tabindex="-1"></a>different methods, over hundreds of years! This is the source of the data we</span>
<span id="cb31-578"><a href="#cb31-578" aria-hidden="true" tabindex="-1"></a>have now in our hands, for free. And how valuable this is!</span>
<span id="cb31-579"><a href="#cb31-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-580"><a href="#cb31-580" aria-hidden="true" tabindex="-1"></a>I see this as the most cogent demonstration of what can be achieved when most</span>
<span id="cb31-581"><a href="#cb31-581" aria-hidden="true" tabindex="-1"></a>researchers or ``data collectors'' in a field aim consistently over a long</span>
<span id="cb31-582"><a href="#cb31-582" aria-hidden="true" tabindex="-1"></a>time at what we now call ``reproducible research''. In biology, we can seldom</span>
<span id="cb31-583"><a href="#cb31-583" aria-hidden="true" tabindex="-1"></a>even get compatible results from a repeat of a single experiment. The</span>
<span id="cb31-584"><a href="#cb31-584" aria-hidden="true" tabindex="-1"></a>complexity of biological systems is no excuse for this, as long as we do not</span>
<span id="cb31-585"><a href="#cb31-585" aria-hidden="true" tabindex="-1"></a>even try to have enough replicates, document methods in enough detail and</span>
<span id="cb31-586"><a href="#cb31-586" aria-hidden="true" tabindex="-1"></a>spend enough time and effort validating and calibrating methods against each</span>
<span id="cb31-587"><a href="#cb31-587" aria-hidden="true" tabindex="-1"></a>other. I think, it is good time for biological research to catchup and follow</span>
<span id="cb31-588"><a href="#cb31-588" aria-hidden="true" tabindex="-1"></a>the meteorologists' example. To achieve this, we need to get researchers in</span>
<span id="cb31-589"><a href="#cb31-589" aria-hidden="true" tabindex="-1"></a>our field to think about the long term value of the data we produce and how</span>
<span id="cb31-590"><a href="#cb31-590" aria-hidden="true" tabindex="-1"></a>to enhance it. This is made difficult, when the evaluation of our</span>
<span id="cb31-591"><a href="#cb31-591" aria-hidden="true" tabindex="-1"></a>productivity is so often based on the most recent 5 years and on the</span>
<span id="cb31-592"><a href="#cb31-592" aria-hidden="true" tabindex="-1"></a>newsworthiness of individual papers rather than on long-term impact and</span>
<span id="cb31-593"><a href="#cb31-593" aria-hidden="true" tabindex="-1"></a>reliability of experimental design and methods.</span>
<span id="cb31-594"><a href="#cb31-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-595"><a href="#cb31-595" aria-hidden="true" tabindex="-1"></a>The \emph{World Meteorological Organization} has encouraged open sharing of</span>
<span id="cb31-596"><a href="#cb31-596" aria-hidden="true" tabindex="-1"></a>data and consistency of methods since its creation as the _International</span>
<span id="cb31-597"><a href="#cb31-597" aria-hidden="true" tabindex="-1"></a>Meteorological Organization_ in 1873. In my opinion, this demonstrates that</span>
<span id="cb31-598"><a href="#cb31-598" aria-hidden="true" tabindex="-1"></a>open availability of original data, allowing comparison and cross-checking</span>
<span id="cb31-599"><a href="#cb31-599" aria-hidden="true" tabindex="-1"></a>can be a strong incentive for adoption of reproducible research approaches.</span>
<span id="cb31-600"><a href="#cb31-600" aria-hidden="true" tabindex="-1"></a>As demonstrated by meteorological observations, the value added by generating</span>
<span id="cb31-601"><a href="#cb31-601" aria-hidden="true" tabindex="-1"></a>data and its metadata in ways that allows the build up of large sets of</span>
<span id="cb31-602"><a href="#cb31-602" aria-hidden="true" tabindex="-1"></a>data by combining a multitude of individual sources can be enormous. Just,</span>
<span id="cb31-603"><a href="#cb31-603" aria-hidden="true" tabindex="-1"></a>how could we have dealt or even detected global climate change lacking</span>
<span id="cb31-604"><a href="#cb31-604" aria-hidden="true" tabindex="-1"></a>consistently collected data from well before we realized that climate is</span>
<span id="cb31-605"><a href="#cb31-605" aria-hidden="true" tabindex="-1"></a>changing?</span>
<span id="cb31-606"><a href="#cb31-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-607"><a href="#cb31-607" aria-hidden="true" tabindex="-1"></a>Considering the shorter time frame of the current pandemic, that useful data</span>
<span id="cb31-608"><a href="#cb31-608" aria-hidden="true" tabindex="-1"></a>are becoming so easily available opens an opportunity for keeping us busy. We</span>
<span id="cb31-609"><a href="#cb31-609" aria-hidden="true" tabindex="-1"></a>can extract new information from these freely available data sets and also by</span>
<span id="cb31-610"><a href="#cb31-610" aria-hidden="true" tabindex="-1"></a>combining them with the data we have earlier collected ourselves. So even if</span>
<span id="cb31-611"><a href="#cb31-611" aria-hidden="true" tabindex="-1"></a>we are confined at home because of the COVID epidemic we can do original</span>
<span id="cb31-612"><a href="#cb31-612" aria-hidden="true" tabindex="-1"></a>research!</span>
<span id="cb31-613"><a href="#cb31-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-614"><a href="#cb31-614" aria-hidden="true" tabindex="-1"></a><span class="fu">## Related reading</span></span>
<span id="cb31-615"><a href="#cb31-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-616"><a href="#cb31-616" aria-hidden="true" tabindex="-1"></a>A paper just published discusses satellite-retrieved UV-A data and its importance for biological research <span class="co">[</span><span class="ot">@Parisi2021</span><span class="co">]</span>. Another paper, available only as a preprint, describes real-time UV-Index retrieval at high spatial and temporal resolution over the whole of Europe <span class="co">[</span><span class="ot">@Kosmopoulos2021</span><span class="co">]</span>. An earlier paper is also of interest as it discusses some of the sources of bias in UV-irradiance retrieved from satellites <span class="co">[</span><span class="ot">@Arola2009</span><span class="co">]</span>. Finally an agronomic paper of interest in relation to how biases in weather data retrieved from satellite observations can affect estimates of biological responses <span class="co">[</span><span class="ot">@Bai2010</span><span class="co">]</span>.</span>
<span id="cb31-617"><a href="#cb31-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-618"><a href="#cb31-618" aria-hidden="true" tabindex="-1"></a>Chapter 8 in my book _Learn R: As a Language_<span class="co">[</span><span class="ot">@Aphalo2020a</span><span class="co">]</span> provides code examples and explanations for importing data from files using additional formats to those I have discussed here.</span>
<span id="cb31-619"><a href="#cb31-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-620"><a href="#cb31-620" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgements</span></span>
<span id="cb31-621"><a href="#cb31-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-622"><a href="#cb31-622" aria-hidden="true" tabindex="-1"></a>I warmly thank the discussions and thoughtful comments from Titta Kotilainen</span>
<span id="cb31-623"><a href="#cb31-623" aria-hidden="true" tabindex="-1"></a>that helped me write and revise this column. I also thank Anders Lindfors for</span>
<span id="cb31-624"><a href="#cb31-624" aria-hidden="true" tabindex="-1"></a>introducing me to the use of some of these sources of information and Heikki</span>
<span id="cb31-625"><a href="#cb31-625" aria-hidden="true" tabindex="-1"></a>Hänninen for sharing a manuscript from his research group, a manuscript that</span>
<span id="cb31-626"><a href="#cb31-626" aria-hidden="true" tabindex="-1"></a>woke up my curiosity about open data even more. This last step made the</span>
<span id="cb31-627"><a href="#cb31-627" aria-hidden="true" tabindex="-1"></a>"energy level" surpass my activation threshold and got me playing with</span>
<span id="cb31-628"><a href="#cb31-628" aria-hidden="true" tabindex="-1"></a>these databases, updating an old computer and downloading many gigabytes of</span>
<span id="cb31-629"><a href="#cb31-629" aria-hidden="true" tabindex="-1"></a>climate, weather, phenological and other data. What started as tinkering</span>
<span id="cb31-630"><a href="#cb31-630" aria-hidden="true" tabindex="-1"></a>several weeks ago, ended providing useful context data for three manuscripts</span>
<span id="cb31-631"><a href="#cb31-631" aria-hidden="true" tabindex="-1"></a>that I am working on at the moment, an ideas for a couple of future articles!</span>
<span id="cb31-632"><a href="#cb31-632" aria-hidden="true" tabindex="-1"></a>Not bad at all, and so an experience worthwhile sharing with our readers.</span>
<span id="cb31-633"><a href="#cb31-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-634"><a href="#cb31-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb31-635"><a href="#cb31-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-636"><a href="#cb31-636" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb31-637"><a href="#cb31-637" aria-hidden="true" tabindex="-1"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0003-3385-972X">
<p>P. J. Aphalo @ ORCID</p>
</a>
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 ISSN 2343-3248 (Helsinki, Finland)
  </li>  
</ul>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../about/about.html">
<p>© 2015-2023 Pedro J. Aphalo</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>