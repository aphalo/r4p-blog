{
  "hash": "e4e80c39ec135b964b6fc3ae461c6364",
  "result": {
    "markdown": "---\ntitle: \"Upgrading R\"\nsubtitle: \"Installing R and reinstalling packages\"\nauthor: \"Pedro J. Aphalo\"\ndate: 2023-02-18\ntoc: true\ncategories: [Using R]\n---\n\n\n## R versions\n\nIt is always best to keep R up-to-date. R versions are named with three digits, e.g. 4.2.2. Versions differing in the last digit, sometimes called dot updates, are almost always bug fixes, adding very little new functionality or at least not requiring changes to packages, and not requiring re-installation of packages. Versions with different middle digit, are less frequent, and may require reinstallation of packages. Because of this, library folder names such as 3.3 or 3.4 are used. Depending on the upgrade a new library folder may be created at the time of installation of a new version of R.\n\nIt is important to remember that different versions of R can coexist in the same computer, each using a different library when required. R can be upgraded by simply manually installing the new version without uninstalling earlier versions, which will remain functional. Earlier versions can be uninstalled at a later time, after checking that the new installation works as expected. If this is the case, and you would like to install the same packages you had in the old installation in the new one, or if you would like to install the same packages in another computer, see the instructions given below under **Copying R libraries**.\n\n## Installing R\n\nJust download the installer from CRAN and run it. If R is already installed, the new version will be installed without removing any older version but making the last installed version the one used by default. For major version updates such as 4.2.3 to 4.3.0 a new library will be created and the recommended packages installed into it. See the next section for an approach to synchronizing the new library with the new one. For minor version updates such as 4.2.2 to 4.2.3 the existing library continues in use. Once you are sure that you the old version of R is no longer needed you can uninstall it and for major updates also delete the library.\n\n## Copying R libraries\n\nThe procedure for a manual copy is conceptually very simple. First we save to a file the names of all packages installed in the old R library, and in a second step we use the saved list to install the same packages in another R library. There are a few additional tricks we can use on the way.\n\n::: callout-caution\n## Availability of packages\n\nMajor R updates usually require packages to be re-built. Exceptionally package code may need to be modified to allow a package to work with a new major version of R. These means that immediately after the release of a major version of R, some packages main remain unavailable for some time. Before deleting the previous version of R it is wise to check that the packages one uses are all available.\n:::\n\nThe first step is to run at the R console of the <em>old version of R</em> the following commands to create a `vector` of character strings with the names of user-installed packages and save the vector to a file on disk. You may want to edit the vector, or to remove packages no longer needed from the old installation before creating the list of packages to install.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# run in old installation\ncurrent.pkg.list &lt;- installed.packages()[is.na(installed.packages()[ , \"Priority\"]), 1]\ncurrent.pkg.list &lt;- as.character(current.pkg.list)\nsave(current.pkg.list, file = \"~/old-pkg-list.rda\")\n```\n:::\n\n\nWe need then to open the console in the newly installed version of R, read the file with the vector of package names, and install them.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# run in new installation\n# If you have installed packages from repos other than CRAN\n# make sure to enable them\nsetRepositories()\n\nload(file = \"~/old-pkg-list.rda\")\nnew.pkg.list &lt;- installed.packages()[is.na(installed.packages()[ , \"Priority\"]), 1]\nnew.pkg.list &lt;- as.character(new.pkg.list)\nmissing.pkg.list &lt;- setdiff(current.pkg.list, new.pkg.list)\ninstall.packages(missing.pkg.list)\n```\n:::\n\n\nAfter installation we can check if there are any differences remaining. Possible causes of failure to install packages are: 1) a different set of repositories was selected, 2) some packages had been installed directly from a Git repository using functions from package 'devtools', 3) some packages are not compatible with the new version of R, and have been removed from CRAN meanwhile the maintainers update, and 4) some packages were installed locally from files and are not available at the default repositories.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check what packages are still missing\nnew.pkg.list &lt;- installed.packages()[is.na(installed.packages()[ , \"Priority\"]), 1]\nnew.pkg.list &lt;- as.character(new.pkg.list)\nmissing.pkg.list &lt;- setdiff(current.pkg.list, new.pkg.list)\ncat(missing.pkg.list, sep = \"\\n\")\n```\n:::\n\n\nAs a final step we may want to clean-up by deleting the file. I suggest not to delete this file immediately as it can still be useful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile.remove(\"~/old-pkg-list.rda)\n```\n:::\n\n\n<em> As a side note</em>, be aware that the list of packages is just an R character vector. Above, we used `save()` to write the vector to a binary file. Alternatively, the vector can be saved to a text file using `cat()`. The next chunk shows how to save the names one per line to a text file, by inserting a new line `\\n` as separator.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(old.pkg.list, sep = \"\\n\", file = \"~/old-pkg-list.txt\")\n```\n:::\n\n\nAnd then read with `scan()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nold.pkg.list &lt;- scan(\"~/old-pkg-list.txt\", what = character())\n```\n:::\n\n\nIn-between saving and reading one can edit the file in a text editor to remove or add package names.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}